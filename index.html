<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="color-scheme" content="dark light" />
		<title>Mirror</title>
		<link rel="manifest" href="/manifest.json" />
		<meta name="mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-capable" content="yes" />
		<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />

		<!-- Critical inline styles for instant first paint -->
		<style>
			body{margin:0;background:#020617;color:#f1f5f9;font-family:ui-sans-serif,system-ui,-apple-system,"Segoe UI",Roboto,Inter,Arial,"Noto Sans",sans-serif;-webkit-font-smoothing:antialiased}
			.bg-glow{position:fixed;inset:0;overflow:hidden;pointer-events:none;z-index:0}
			#mainGrid{display:grid;height:100%;width:100%}
		</style>

		<!-- Preload critical assets -->
		<link rel="preload" href="/styles/app.css" as="style" />
		<link rel="preload" href="/app.js?v=2026-02-20-01" as="script" />
		<link rel="preload" href="/vendor/yjs.bundle.js" as="script" />

		<!-- DNS prefetch for CDNs -->
		<link rel="dns-prefetch" href="https://cdn.tailwindcss.com" />
		<link rel="dns-prefetch" href="https://cdn.jsdelivr.net" />

		<!-- Tailwind (CDN) - loaded async to not block first paint -->
		<script>
			(function(){
				var s=document.createElement('script');
				s.src='https://cdn.tailwindcss.com';
				s.onload=function(){
					tailwind.config={theme:{extend:{fontFamily:{sans:["ui-sans-serif","system-ui","-apple-system","Segoe UI","Roboto","Inter","Arial","Noto Sans","sans-serif"]},boxShadow:{soft:"0 10px 30px rgba(0,0,0,.25)"}}}};
				};
				document.head.appendChild(s);
			})();
		</script>
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css"
			media="print" onload="this.media='all'" />
		<link rel="stylesheet" href="/styles/app.css" />
	</head>
	<body class="min-h-screen bg-slate-950 text-slate-100 antialiased">
		<div class="bg-glow" aria-hidden="true">
			<div id="bgBlobTop" class="bg-blob bg-blob-top"></div>
			<div id="bgBlobBottom" class="bg-blob bg-blob-bottom"></div>
		</div>
		<main
			class="relative mx-auto flex h-[calc(100vh-48px)] w-[calc(100vw-48px)] max-w-none items-stretch px-0 py-0 sm:h-[calc(100vh-40px)] sm:w-[calc(100vw-40px)]">
			<div id="mainGrid" class="grid h-full w-full grid-cols-1 gap-4 lg:grid-cols-[360px_1fr]">
				<section
					id="psPanel"
					class="flex h-full min-h-0 flex-col overflow-hidden rounded-2xl border border-white/10 bg-white/5 p-4 shadow-soft backdrop-blur sm:p-6">
					<header class="flex items-start justify-between gap-3">
						<div>
							<h2 class="text-sm font-semibold tracking-tight" data-i18n="ps.title">
								Personal Space
							</h2>
						</div>
						<button
							id="psCloseMobile"
							type="button"
							class="mobile-only inline-flex h-8 w-8 items-center justify-center rounded-lg border border-white/10 bg-white/5 text-slate-200 transition hover:bg-white/10 active:bg-white/15"
							title="Schließen"
							aria-label="Schließen"
							data-i18n-title="ps.close"
							data-i18n-aria="ps.close">
							<svg
								viewBox="0 0 24 24"
								fill="none"
								stroke="currentColor"
								stroke-width="2"
								stroke-linecap="round"
								stroke-linejoin="round"
								class="h-4 w-4">
								<path d="M18 6L6 18" />
								<path d="M6 6l12 12" />
							</svg>
						</button>
					</header>

					<div id="psUnauthed" class="mt-4 flex-1">
						<button
							id="addPersonalSpace"
							type="button"
							class="w-full rounded-lg border border-white/10 bg-white/10 px-3 py-2 text-sm text-slate-100 transition hover:bg-white/15 active:bg-white/20"
							data-i18n="ps.add">
							Add Personal Space
						</button>
						<p class="mt-2 text-xs text-slate-400" data-i18n="ps.add_hint">
							You’ll receive a verification link by email.
						</p>
						<div
							id="psDevLink"
							class="mt-2 hidden rounded-lg border border-white/10 bg-slate-950/30 p-2 text-xs text-slate-200"></div>
					</div>

					<div id="psAuthed" class="mt-4 hidden flex min-h-0 flex-1 flex-col">
						<div class="mt-1">
							<div class="flex items-start gap-3">
								<button
									id="psNewNote"
									type="button"
									class="inline-flex shrink-0 items-center whitespace-nowrap rounded-xl border border-fuchsia-400/30 bg-fuchsia-500/15 px-4 py-2.5 text-sm font-semibold text-slate-100 shadow-soft transition hover:bg-fuchsia-500/20 active:opacity-90"
									data-i18n="ps.new_note">
									New note
								</button>
							</div>
						</div>
						<div id="psHint" class="mt-2 text-xs text-slate-400"></div>

						<div class="mt-4">
							<div class="flex items-center justify-between gap-2">
								<div class="flex items-center gap-2">
									<button
										id="psToggleTags"
										type="button"
										class="inline-flex items-center gap-1 text-xs font-medium text-slate-200 transition hover:text-slate-100"
										aria-expanded="true">
										<span data-i18n="ps.tags">Tags</span>
										<svg
											data-role="chevron"
											viewBox="0 0 24 24"
											fill="none"
											stroke="currentColor"
											stroke-width="2"
											stroke-linecap="round"
											stroke-linejoin="round"
											class="h-4 w-4 text-slate-400 transition-transform">
											<path d="M6 9l6 6 6-6" />
										</svg>
									</button>
									<span id="psTagsActiveInfo" class="text-[11px] text-slate-400"></span>
								</div>
								<div id="psTagControls" class="flex items-center gap-2">
									<select
										id="psTagFilterMode"
										class="rounded-lg border border-white/10 bg-slate-950/30 px-2 py-1.5 text-xs text-slate-200 shadow-soft backdrop-blur transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30">
										<option value="and" selected data-i18n="ps.tags.and">AND</option>
										<option value="or" data-i18n="ps.tags.or">OR</option>
									</select>
								</div>
							</div>
							<div id="psTagsPanel" class="mt-2">
								<div class="flex flex-col gap-2" id="psTags"></div>
							</div>
						</div>

						<div class="mt-4 flex min-h-0 flex-1 flex-col">
							<div class="flex flex-col gap-2">
								<div class="flex items-center gap-2">
									<div class="text-xs font-medium text-slate-200" data-i18n="ps.notes">
										Notes
									</div>
									<div
										id="psCount"
										class="rounded-full border border-white/10 bg-white/5 px-2 py-0.5 text-[11px] text-slate-300"
										title="Number of notes">
										0
									</div>
								</div>
								<div class="flex items-center gap-2 pr-1">
									<button
										id="psPinnedToggle"
										type="button"
										class="hidden inline-flex h-8 w-8 items-center justify-center rounded-lg border border-white/10 bg-transparent text-slate-300 transition hover:bg-white/5 active:bg-white/10"
										title="Pinned only"
										aria-label="Pinned only"
										data-i18n-title="ps.pinned_only"
										data-i18n-aria="ps.pinned_only"
										aria-pressed="false">
										<svg
											viewBox="0 0 24 24"
											fill="none"
											stroke="currentColor"
											stroke-width="2"
											stroke-linecap="round"
											stroke-linejoin="round"
											class="h-4 w-4">
											<path d="M4 4v16" />
											<path d="M4 4h12l-2 5 2 5H4" />
										</svg>
									</button>
									<button
										id="psCommentsToggle"
										type="button"
										class="hidden inline-flex h-8 w-8 items-center justify-center rounded-lg border border-white/10 bg-transparent text-slate-300 transition hover:bg-white/5 active:bg-white/10"
										title="Mit Kommentaren"
										aria-label="Mit Kommentaren"
										data-i18n-title="ps.comments_only"
										data-i18n-aria="ps.comments_only"
										aria-pressed="false">
										<svg
											viewBox="0 0 24 24"
											fill="none"
											stroke="currentColor"
											stroke-width="2"
											stroke-linecap="round"
											stroke-linejoin="round"
											class="h-4 w-4">
											<path d="M21 15a4 4 0 0 1-4 4H7l-4 3v-3a4 4 0 0 1-4-4V7a4 4 0 0 1 4-4h14a4 4 0 0 1 4 4z" />
										</svg>
									</button>
									<div class="relative flex flex-1 items-center">
										<div class="relative flex-1 min-w-0">
											<input
												id="psSearch"
												type="search"
												placeholder="Search..."
												data-i18n-placeholder="ps.search"
												class="w-full min-w-0 rounded-lg border border-white/10 bg-slate-950/30 px-2.5 py-1.5 pr-14 text-xs text-slate-200 shadow-soft backdrop-blur transition placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30" />
											<button
												id="psSearchHelp"
												type="button"
												class="ps-search-help-btn"
												aria-label="Search help">
												<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-3 w-3"><circle cx="12" cy="12" r="10"/><path d="M9.09 9a3 3 0 0 1 5.83 1c0 2-3 3-3 3"/><line x1="12" y1="17" x2="12.01" y2="17"/></svg>
											</button>
											<button
												id="psSortMenuBtn"
												type="button"
												class="ps-sort-inline-btn"
												title="Sortierung"
												aria-label="Sortierung"
												data-i18n-title="ps.sort"
												data-i18n-aria="ps.sort"
												aria-expanded="false">
												<svg
													viewBox="0 0 24 24"
													fill="none"
													stroke="currentColor"
													stroke-width="1.5"
													stroke-linecap="round"
													stroke-linejoin="round"
													class="h-3.5 w-3.5">
													<path d="M3 6h18M6 12h12M9 18h6" />
												</svg>
											</button>
											<div
												id="psSortMenu"
												class="absolute right-0 top-10 z-30 hidden w-48 overflow-hidden rounded-xl border border-white/10 bg-slate-950/80 shadow-soft backdrop-blur">
												<div class="border-b border-white/10 px-3 py-2 text-[11px] text-slate-300">
													<span data-i18n="ps.sort_by">Sort by</span>
												</div>
												<div class="flex flex-col gap-1 p-1 text-xs">
													<button
														type="button"
														data-sort="updated"
														class="ps-sort-option flex items-center justify-between rounded-lg px-2.5 py-2 text-left text-slate-200 transition hover:bg-white/5">
														<span data-i18n="ps.sort.modified">Modified</span>
														<span class="ps-sort-check text-fuchsia-200">✓</span>
													</button>
													<button
														type="button"
														data-sort="created"
														class="ps-sort-option flex items-center justify-between rounded-lg px-2.5 py-2 text-left text-slate-200 transition hover:bg-white/5">
														<span data-i18n="ps.sort.created">Created</span>
														<span class="ps-sort-check text-fuchsia-200">✓</span>
													</button>
													<button
														type="button"
														data-sort="accessed"
														class="ps-sort-option flex items-center justify-between rounded-lg px-2.5 py-2 text-left text-slate-200 transition hover:bg-white/5">
														<span data-i18n="ps.sort.accessed">Accessed</span>
														<span class="ps-sort-check text-fuchsia-200">✓</span>
													</button>
													<button
														type="button"
														data-sort="text"
														class="ps-sort-option flex items-center justify-between rounded-lg px-2.5 py-2 text-left text-slate-200 transition hover:bg-white/5">
														<span data-i18n="ps.sort.text">Text</span>
														<span class="ps-sort-check text-fuchsia-200">✓</span>
													</button>
												</div>
											</div>
										</div>
										<button
											id="psSaveQuery"
											type="button"
											class="ps-save-query-btn"
											style="display:none"
											title="Save query"
											aria-label="Save query"
											data-i18n-title="ps.save_query"
											data-i18n-aria="ps.save_query">
											<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4"><path d="M19 21l-7-5-7 5V5a2 2 0 0 1 2-2h10a2 2 0 0 1 2 2z"/></svg>
										</button>
									</div>
								</div>
							</div>
							<div
								id="psSavedQueries"
								class="hidden mt-1.5 flex flex-wrap gap-1.5 pr-1"></div>
							<div
								id="psQueryResults"
								class="hidden mt-2 rounded-xl overflow-hidden"></div>
							<div
								id="psList"
								class="mt-2 flex min-h-0 flex-1 flex-col overflow-y-auto pr-1"></div>
						</div>
					</div>
					<div class="mt-auto pt-3">
						<button
							id="psSettingsBtn"
							type="button"
							class="inline-flex h-[38px] w-[38px] items-center justify-center rounded-xl border border-white/10 bg-white/5 text-xs text-slate-200 transition hover:bg-white/10 active:bg-white/15"
							aria-label="Open settings"
							title="Settings"
							data-i18n-aria="settings.open"
							data-i18n-title="settings.open">
							<svg
								viewBox="0 0 24 24"
								fill="none"
								stroke="currentColor"
								stroke-width="2"
								stroke-linecap="round"
								stroke-linejoin="round"
								class="h-4 w-4">
								<path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z" />
								<path
									d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51h.09a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9c0 .67.39 1.27 1 1.51H21a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z" />
							</svg>
						</button>
					</div>
				</section>

				<section
					id="editorPanel"
					class="flex h-full min-h-0 w-full flex-col rounded-2xl border border-white/10 bg-white/5 p-4 shadow-soft backdrop-blur sm:p-6">
					<header
						class="flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between">
						<div class="min-w-0">
							<div class="group flex items-center gap-2">
								<div id="statusDot" class="h-2.5 w-2.5 rounded-full bg-slate-500"></div>
								<h1 class="text-lg font-semibold tracking-tight">Mirror</h1>
								<button
									id="togglePersonalSpace"
									type="button"
									class="ml-1 inline-flex h-8 items-center justify-center gap-1 rounded-lg border border-white/10 bg-transparent px-2.5 text-xs text-slate-200 opacity-0 transition hover:bg-white/5 group-hover:opacity-100 focus-visible:opacity-100 active:bg-white/10"
									title="Toggle Personal Space"
									aria-label="Toggle Personal Space"
									aria-pressed="true">
									<svg
										data-role="psChevron"
										viewBox="0 0 24 24"
										fill="none"
										stroke="currentColor"
										stroke-width="2"
										stroke-linecap="round"
										stroke-linejoin="round"
										class="h-4 w-4 text-slate-300 transition-transform">
										<path d="M14 7l-5 5 5 5" />
									</svg>
								</button>
								<button
									id="toggleHeader"
									type="button"
									class="ml-1 inline-flex h-8 items-center justify-center rounded-lg border border-white/10 bg-transparent px-2 text-xs text-slate-200 opacity-0 transition hover:bg-white/5 group-hover:opacity-100 focus-visible:opacity-100 active:bg-white/10"
									title="Toggle Header"
									aria-label="Toggle Header"
									aria-expanded="true">
									<svg
										data-role="headerChevron"
										viewBox="0 0 24 24"
										fill="none"
										stroke="currentColor"
										stroke-width="2"
										stroke-linecap="round"
										stroke-linejoin="round"
										class="h-4 w-4 text-slate-300 transition-transform">
										<path d="M18 15l-6-6-6 6" />
									</svg>
								</button>
								<button
									id="noteCloseMobile"
									type="button"
									class="mobile-only inline-flex h-8 w-8 items-center justify-center rounded-lg border border-white/10 bg-white/5 text-xs text-slate-200 transition hover:bg-white/10 active:bg-white/15"
									title="Notiz schließen"
									aria-label="Notiz schließen"
									data-i18n-title="editor.note_close"
									data-i18n-aria="editor.note_close">
									<svg
										viewBox="0 0 24 24"
										fill="none"
										stroke="currentColor"
										stroke-width="2"
										stroke-linecap="round"
										stroke-linejoin="round"
										class="h-4 w-4">
										<path d="M18 6L6 18" />
										<path d="M6 6l12 12" />
									</svg>
								</button>
							</div>

							<div class="mt-4 flex flex-wrap items-center gap-2" data-header-detail="true">
								<div class="relative">
									<label for="roomInput" class="sr-only" data-i18n="header.room_label">Room</label>
									<input
										id="roomInput"
										list="roomOptions"
										class="w-44 sm:w-48 rounded-lg border border-white/10 bg-slate-950/40 px-3 py-2 text-sm text-slate-100 placeholder:text-slate-500 outline-none ring-1 ring-transparent transition focus:border-white/20 focus:ring-fuchsia-400/25"
										placeholder="Room (e.g. KubernetesRoom123)"
										data-i18n-placeholder="header.room_placeholder" />
									<datalist id="roomOptions"></datalist>
								</div>
								<button
									id="joinRoom"
									type="button"
									class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-sm text-slate-100 transition hover:bg-white/5 active:bg-white/10">
									<span data-i18n="header.join">Join</span>
								</button>
								<button
									id="newRoom"
									type="button"
									class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-sm text-slate-200 transition hover:bg-white/5 active:bg-white/10">
									<span data-i18n="header.new">New</span>
								</button>
								<button
									id="copyLink"
									type="button"
									class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-sm text-slate-100 transition hover:bg-white/5 active:bg-white/10">
									<span data-i18n="header.share_room">Share room</span>
								</button>
								<div class="flex items-center gap-2">
									<label for="favoritesSelect" class="sr-only" data-i18n="header.favorites_label">Favorites</label>
									<select
										id="favoritesSelect"
										class="w-44 sm:w-56 rounded-lg border border-white/10 bg-slate-950/40 px-3 py-2 text-sm text-slate-100 outline-none ring-1 ring-transparent transition focus:border-white/20 focus:ring-fuchsia-400/25">
										<option value="" data-i18n="header.favorites_placeholder">Favorites…</option>
									</select>
									<button
										id="toggleFavorite"
										type="button"
										class="inline-flex h-10 w-10 items-center justify-center rounded-lg border border-white/10 bg-transparent text-slate-100 transition hover:bg-white/5 active:bg-white/10"
										title="Add/remove favorite"
										aria-label="Add/remove favorite"
										data-i18n-title="header.favorite_toggle"
										data-i18n-aria="header.favorite_toggle">
										<svg
											viewBox="0 0 24 24"
											fill="none"
											stroke="currentColor"
											stroke-width="2"
											stroke-linecap="round"
											stroke-linejoin="round"
											class="h-5 w-5">
											<path
												d="M12 17.3l-6.18 3.25 1.18-6.88L2 8.9l6.9-1L12 1.8l3.1 6.1 6.9 1-5 4.77 1.18 6.88z" />
										</svg>
									</button>
								</div>
							</div>
							<div class="mt-2 flex w-full flex-col gap-2 sm:mt-3">
								<div class="room-tabs-scroll max-w-full">
									<div
										id="roomTabs"
										class="flex max-w-full flex-nowrap items-center gap-2 whitespace-nowrap pb-1"></div>
								</div>
							</div>

						</div>
						<div class="shrink-0 text-left text-xs text-slate-300 sm:text-right">
							<div class="flex items-center justify-start gap-2 sm:justify-end">
									<div>
										<span data-i18n="header.room_prefix">Room:</span>
										<span id="roomLabel" class="font-medium text-slate-100"></span>
									</div>
							</div>
							<div
								class="mt-1 flex flex-col items-start gap-1 text-[11px] text-slate-400 sm:items-end"
								data-header-detail="true">
								<div id="presenceSummary">0 Nutzer online</div>
								<div class="flex items-center justify-start gap-2 sm:justify-end">
									<div id="crdtStatus" class="hidden text-[10px] text-slate-500"></div>
									<button
										id="toggleCrdtMarks"
										type="button"
										class="inline-flex h-6 w-6 items-center justify-center rounded-md border border-white/10 bg-transparent text-slate-400 transition hover:bg-white/5 active:bg-white/10"
											title="CRDT-Markierung ausblenden"
											aria-label="CRDT-Markierung ausblenden"
											data-i18n-title="header.crdt_toggle"
											data-i18n-aria="header.crdt_toggle"
										aria-pressed="true">
										<svg
											viewBox="0 0 24 24"
											fill="none"
											stroke="currentColor"
											stroke-width="2"
											stroke-linecap="round"
											stroke-linejoin="round"
											class="h-3.5 w-3.5">
											<path d="M12 2l8 4-8 4-8-4 8-4z" />
											<path d="M4 10l8 4 8-4" />
											<path d="M4 14l8 4 8-4" />
										</svg>
									</button>
								</div>
								<div
									id="presenceList"
									class="flex flex-wrap justify-start gap-1 sm:justify-end"></div>
							</div>
							<div class="mt-1 hidden text-slate-400" id="wsHint" data-header-detail="true"></div>
						</div>
					</header>

					<div class="mt-2 flex min-h-0 flex-1 flex-col sm:mt-2">
						<div
							id="editorPreviewGrid"
							class="grid h-full min-h-0 grid-cols-1 gap-3 lg:grid-cols-1">
							<div class="flex min-h-0 min-w-0 flex-col">
								<label for="mirror" class="sr-only">Text</label>
								<div class="relative flex min-h-0 flex-1">
									<textarea
										id="mirror"
										class="h-full min-h-0 w-full resize-none rounded-xl border border-white/10 bg-slate-950/40 px-4 pt-20 pb-12 pr-11 font-sans text-base leading-relaxed text-slate-100 placeholder:text-slate-500 outline-none transition focus:border-white/15"
										placeholder="Type something — everyone with this link sees it instantly…"
										autocomplete="off"
										wrap="off"
										spellcheck="false"></textarea>
									<div
										id="attributionOverlay"
										class="pointer-events-none absolute inset-0 hidden overflow-hidden rounded-xl px-4 pt-20 pb-12 pr-11 font-sans text-base leading-relaxed text-slate-100">
										<div id="attributionOverlayContent"></div>
									</div>
										<div
											id="commentOverlay"
											class="pointer-events-none absolute inset-0 hidden overflow-hidden rounded-xl px-4 pt-20 pb-12 pr-11 font-sans text-base leading-relaxed text-slate-100">
											<div id="commentOverlayContent"></div>
										</div>
										<div
											id="excalidrawEmbed"
											class="excalidraw-embed hidden"
											aria-hidden="true">
											<div
												id="excalidrawDragHandle"
												class="excalidraw-drag-handle help-icon"
												role="button"
												aria-label="Excalidraw verschieben"
												title="Excalidraw verschieben">
												<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4">
													<path d="M9 5l3-3 3 3" />
													<path d="M5 9l-3 3 3 3" />
													<path d="M19 9l3 3-3 3" />
													<path d="M9 19l3 3 3-3" />
													<path d="M5 12h14" />
													<path d="M12 5v14" />
												</svg>
											</div>
											<iframe
												src="/excalidraw-embed.html"
												title="Excalidraw"
												loading="lazy"
												allow="clipboard-write; fullscreen"
												referrerpolicy="no-referrer"
												class="excalidraw-iframe"></iframe>
										</div>
										<div
											id="excelEmbed"
											class="excel-embed hidden"
											data-excel-base="https://mirror-ethercalc.fly.dev"
											aria-hidden="true">
											<div
												id="excelDragHandle"
												class="excel-drag-handle help-icon"
												role="button"
												aria-label="Excel verschieben"
												title="Excel verschieben">
												<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4">
													<path d="M9 5l3-3 3 3" />
													<path d="M5 9l-3 3 3 3" />
													<path d="M19 9l3 3-3 3" />
													<path d="M9 19l3 3 3-3" />
													<path d="M5 12h14" />
													<path d="M12 5v14" />
												</svg>
											</div>
											<iframe
												src="https://mirror-ethercalc.fly.dev"
												title="Tabelle"
												loading="lazy"
												allow="clipboard-read; clipboard-write; fullscreen"
												referrerpolicy="no-referrer"
												class="excel-iframe"></iframe>
										</div>
											<div
												id="linearEmbed"
												class="linear-embed hidden"
												aria-hidden="true">
												<div
													id="linearDragHandle"
													class="linear-drag-handle help-icon"
													role="button"
													aria-label="Linear verschieben"
													title="Linear verschieben">
													<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4">
														<path d="M9 5l3-3 3 3" />
														<path d="M5 9l-3 3 3 3" />
														<path d="M19 9l3 3-3 3" />
														<path d="M9 19l3 3 3-3" />
														<path d="M5 12h14" />
														<path d="M12 5v14" />
													</svg>
												</div>
												<div class="linear-embed-toolbar">
													<div class="linear-embed-title" data-i18n="linear.embed.title">Linear</div>
													<div id="linearProjectHeader" class="linear-project-header hidden"></div>
													<select
														id="linearProjectSelect"
														class="linear-project-select"
														aria-label="Projekt auswählen">
														<option value="" data-i18n="linear.embed.select_placeholder">Projekt auswählen</option>
													</select>
													<button
														id="linearProjectApply"
														type="button"
														class="linear-embed-btn"
														data-i18n="linear.embed.apply">
														<svg class="linear-embed-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
															<path d="M18 8a3 3 0 1 0-2.83-4" />
															<path d="M6 12a3 3 0 1 0 0 6" />
															<path d="M18 16a3 3 0 1 0-2.83 4" />
															<path d="M8.59 13.51l6.83 3.98" />
															<path d="M15.42 6.51l-6.83 3.98" />
														</svg>
														Teilen
													</button>
													<button
														id="linearRefresh"
														type="button"
														class="linear-embed-btn"
														data-i18n="linear.embed.refresh">
														<svg class="linear-embed-icon" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true">
															<path d="M21 12a9 9 0 1 1-2.64-6.36" />
															<path d="M21 3v6h-6" />
														</svg>
														Aktualisieren
													</button>
												</div>
												<div class="linear-embed-tabs" role="tablist" aria-label="Linear Ansicht">
													<button
														id="linearViewBoard"
														type="button"
														class="linear-embed-tab"
														aria-pressed="true"
														data-i18n="linear.view.board">Board</button>
													<button
														id="linearViewStats"
														type="button"
														class="linear-embed-tab"
														aria-pressed="false"
														data-i18n="linear.view.stats">Auswertung</button>
												</div>
												<div id="linearStatus" class="linear-status"></div>
												<div id="linearEmpty" class="linear-empty" data-i18n="linear.embed.empty">
													Keine Aufgaben geladen.
												</div>
												<div id="linearTaskList" class="linear-task-list"></div>
												<div id="linearStatsPanel" class="linear-stats hidden" aria-live="polite"></div>
											</div>
									<div
										id="slashMenu"
										class="absolute left-2 top-12 z-40 hidden w-[min(92vw,360px)] overflow-hidden rounded-xl border border-white/10 bg-slate-950/80 shadow-soft backdrop-blur">
											<div
												class="border-b border-white/10 px-3 py-2 text-[11px] text-slate-300">
												<span data-i18n="slash.menu.title">Slash commands</span>
												<span class="text-slate-500" data-i18n="slash.menu.hint"
													>(Enter/Tab to insert, ↑↓ to navigate)</span
												>
											</div>
										<div
											id="slashMenuList"
											class="max-h-56 overflow-auto p-1"></div>
									</div>
									<div
										id="wikiMenu"
										class="absolute left-2 top-12 z-40 hidden w-[min(92vw,380px)] overflow-hidden rounded-xl border border-white/10 bg-slate-950/80 shadow-soft backdrop-blur">
										<div
											class="border-b border-white/10 px-3 py-2 text-[11px] text-slate-300">
											Notiz-Links
											<span class="text-slate-500"
												>(Enter/Tab to insert, ↑↓ to navigate)</span
											>
										</div>
										<div
											id="wikiMenuList"
											class="max-h-56 overflow-auto p-1"></div>
									</div>
									<div
										id="psMetaOverlay"
										class="pointer-events-none absolute inset-0 overflow-hidden">
										<div
											id="psMetaYaml"
											class="absolute left-2 right-2 top-12 hidden rounded-lg border border-white/10 bg-slate-950/85 px-2 py-1 pr-10 text-[10px] leading-snug text-slate-300 shadow-soft backdrop-blur will-change-transform">
											<pre class="whitespace-pre-wrap font-mono"></pre>
										</div>
									</div>
									<div id="psEditorTagsBar" class="absolute left-2 right-2 top-2 z-10">
										<label for="psEditorTagsInput" class="sr-only">Tags</label>
										<div class="ps-tags-bar-inner">
											<div id="psEditorTagsPills" class="ps-tags-pills"></div>
											<input
												id="psEditorTagsInput"
												type="text"
												autocomplete="off"
												spellcheck="false"
												placeholder="+ Tag"
												class="ps-tags-input" />
											<!-- Hidden inputs to preserve JS references -->
											<input type="hidden" id="psEditorYearTag" />
											<input type="hidden" id="psEditorMonthTag" />
											<input type="hidden" id="psEditorCategoryTag" />
											<input type="hidden" id="psEditorSubcategoryTag" />
										</div>
										<div
											id="psEditorTagsSuggest"
											class="absolute mt-1 hidden max-h-40 overflow-y-auto rounded-lg border border-white/10 bg-slate-950/95 py-1 text-xs text-slate-200 shadow-soft backdrop-blur z-50"></div>
									</div>
									<div
										id="selectionMenu"
										class="absolute z-40 hidden min-w-[240px] overflow-hidden rounded-xl border border-white/10 bg-slate-950/85 shadow-soft backdrop-blur">
										<div class="flex flex-wrap items-center gap-1 p-1">
											<button
												type="button"
												data-selection-action="bold"
												class="inline-flex h-8 items-center justify-center rounded-lg border border-white/10 px-2 text-xs text-slate-200 transition hover:bg-white/5"
												title="Make the selected text bold"
												data-i18n-title="menu.bold_tip">
												<strong>B</strong>
											</button>
											<button
												type="button"
												data-selection-action="italic"
												class="inline-flex h-8 items-center justify-center rounded-lg border border-white/10 px-2 text-xs text-slate-200 transition hover:bg-white/5"
												title="Italicize the selected text"
												data-i18n-title="menu.italic_tip">
												<em>I</em>
											</button>
											<button
												type="button"
												data-selection-action="strike"
												class="inline-flex h-8 items-center justify-center rounded-lg border border-white/10 px-2 text-xs text-slate-200 transition hover:bg-white/5"
												title="Strike through the selected text"
												data-i18n-title="menu.strike_tip">
												<span class="line-through">S</span>
											</button>
											<button
												type="button"
												data-selection-action="password"
												class="inline-flex h-8 items-center justify-center rounded-lg border border-white/10 px-2 text-xs text-slate-200 transition hover:bg-white/5"
												title="Hide the selected text as a password token"
												aria-label="Hide the selected text as a password token"
												data-i18n-title="menu.password_hide_tip"
												data-i18n-aria="menu.password_hide_tip">
												<span data-i18n="menu.password">PW</span>
											</button>

											<button
												type="button"
												data-selection-action="quote"
												class="inline-flex h-8 items-center justify-center rounded-lg border border-white/10 px-2 text-xs text-slate-200 transition hover:bg-white/5"
												title="Turn the selection into a quote block"
												data-i18n-title="menu.blockquote_tip">
												“
											</button>
											<button
												type="button"
												data-selection-action="ul"
												class="inline-flex h-8 items-center justify-center rounded-lg border border-white/10 px-2 text-xs text-slate-200 transition hover:bg-white/5"
												title="Turn lines into a bulleted list"
												data-i18n-title="menu.bullet_tip">
												<span data-i18n="menu.bullet_label">• List</span>
											</button>
											<button
												type="button"
												data-selection-action="ol"
												class="inline-flex h-8 items-center justify-center rounded-lg border border-white/10 px-2 text-xs text-slate-200 transition hover:bg-white/5"
												title="Turn lines into a numbered list"
												data-i18n-title="menu.numbered_tip">
												<span data-i18n="menu.numbered_label">1. List</span>
											</button>
											<button
												type="button"
												data-selection-action="todo"
												class="inline-flex h-8 items-center justify-center rounded-lg border border-white/10 px-2 text-xs text-slate-200 transition hover:bg-white/5"
												title="Turn lines into a task list with checkboxes"
												data-i18n-title="menu.task_tip">
												<span data-i18n="menu.task_label">☐ Task</span>
											</button>
											<button
												type="button"
												data-selection-action="divider"
												class="inline-flex h-8 items-center justify-center rounded-lg border border-white/10 px-2 text-xs text-slate-200 transition hover:bg-white/5"
												title="Insert a divider line"
												data-i18n-title="menu.divider_tip">
												---
											</button>
											<button
												type="button"
												data-selection-action="code"
												class="inline-flex h-8 items-center justify-center rounded-lg border border-white/10 px-2 text-xs text-slate-200 transition hover:bg-white/5"
												title="Wrap the selection in a code block"
												data-i18n-title="menu.code_tip">
												&lt;/&gt;
											</button>
											<button
												type="button"
												data-selection-action="link"
												class="inline-flex h-8 items-center justify-center rounded-lg border border-white/10 px-2 text-xs text-slate-200 transition hover:bg-white/5"
												title="Convert the selection into a link"
												data-i18n-title="menu.link_tip">
												<span data-i18n="menu.link">Link</span>
											</button>
											<button
												type="button"
												data-selection-action="comment"
												class="inline-flex h-8 items-center justify-center rounded-lg border border-white/10 px-2 text-xs text-slate-200 transition hover:bg-white/5"
												title="Add a comment to the selection"
												data-i18n-title="menu.comment_tip">
												<span data-i18n="menu.comment">Comment</span>
											</button>
											<div class="mx-1 h-6 w-px bg-white/10"></div>
											<button
												type="button"
												data-selection-action="sort"
												class="inline-flex h-8 items-center justify-center rounded-lg border border-white/10 px-2 text-xs text-slate-200 transition hover:bg-white/5"
												title="Sort selected lines A–Z"
												data-i18n-title="menu.sort_az_tip">
												<span data-i18n="menu.sort_az">Sort A–Z</span>
											</button>
											<button
												type="button"
												data-selection-action="help"
												class="inline-flex h-8 items-center justify-center rounded-lg border border-white/10 px-2 text-xs text-slate-200 transition hover:bg-white/5"
												title="Open formatting help"
												aria-label="Open formatting help"
												data-i18n-title="menu.help_tip"
												data-i18n-aria="menu.help_tip">
												?
											</button>
										</div>
									</div>
									<div
										id="codeLangWrap"
										class="absolute left-2 top-2 hidden flex items-center gap-2">
										<label for="codeLang" class="sr-only" data-i18n="menu.code_lang_label">Language</label>
										<select
											id="codeLang"
											class="h-9 w-36 rounded-lg border border-white/10 bg-slate-950/60 px-2.5 text-sm text-slate-100 shadow-soft backdrop-blur outline-none ring-1 ring-transparent transition focus:border-white/20 focus:ring-fuchsia-400/25"
											title="Language for code block"
											data-i18n-title="menu.code_lang_title">
											<option value="python">Python</option>
											<option value="javascript">JavaScript</option>
											<option value="bash">Shell</option>
											<option value="json">JSON</option>
											<option value="yaml">YAML</option>
											<option value="sql">SQL</option>
											<option value="html">HTML</option>
											<option value="css">CSS</option>
										</select>
									</div>
									<button
										id="tableMenuBtn"
										type="button"
										class="absolute right-2 top-12 hidden inline-flex h-9 w-9 items-center justify-center rounded-lg border border-white/10 bg-white/5 text-slate-200 transition hover:bg-white/10 active:bg-white/15"
										title="Table menu"
										aria-label="Table menu">
										<svg
											viewBox="0 0 24 24"
											fill="none"
											stroke="currentColor"
											stroke-width="2"
											stroke-linecap="round"
											stroke-linejoin="round"
											class="h-4 w-4">
											<rect x="3" y="3" width="18" height="18" rx="2" />
											<path d="M3 9h18" />
											<path d="M3 15h18" />
											<path d="M9 3v18" />
											<path d="M15 3v18" />
										</svg>
									</button>
									<button
										id="psMetaToggle"
										type="button"
										class="absolute bottom-2 z-10 inline-flex h-9 w-9 items-center justify-center rounded-lg border border-white/10 bg-white/5 text-slate-200 shadow-soft backdrop-blur-[24px] backdrop-saturate-150 transition hover:bg-white/10 active:bg-white/15"
										style="right: 52px"
										title="Meta anzeigen/ausblenden"
										aria-label="Meta anzeigen/ausblenden"
										aria-pressed="true">
										<svg
											viewBox="0 0 24 24"
											fill="none"
											stroke="currentColor"
											stroke-width="2"
											stroke-linecap="round"
											stroke-linejoin="round"
											class="h-4 w-4">
											<circle cx="12" cy="12" r="9" />
											<path d="M12 10v6" />
											<path d="M12 7h.01" />
										</svg>
									</button>
									<div
										id="psMetaYamlInline"
											class="pointer-events-none absolute left-2 right-12 top-2 hidden rounded-lg border border-white/5 bg-slate-950/40 px-2 py-1 text-[10px] leading-snug text-slate-400 backdrop-blur">
											<pre class="whitespace-pre-wrap font-mono"></pre>
									</div>
									<button
										id="clearMirror"
										type="button"
										class="absolute bottom-2 z-10 inline-flex h-9 w-9 items-center justify-center rounded-lg border border-white/10 bg-white/5 text-slate-200 shadow-soft backdrop-blur-[24px] backdrop-saturate-150 transition hover:bg-white/10 active:bg-white/15"
											style="right: 96px"
											title="Clear input"
											aria-label="Clear input"
											data-i18n-title="editor.clear_input"
											data-i18n-aria="editor.clear_input">
										<svg
											viewBox="0 0 24 24"
											fill="none"
											stroke="currentColor"
											stroke-width="2"
											stroke-linecap="round"
											stroke-linejoin="round"
											class="h-4 w-4">
											<path d="M3 6h18" />
											<path d="M8 6V4h8v2" />
											<path d="M6 6l1 16h10l1-16" />
											<path d="M10 11v6" />
											<path d="M14 11v6" />
										</svg>
									</button>
									<button
										id="copyMirror"
										type="button"
											class="absolute bottom-2 right-2 z-10 inline-flex h-9 w-9 items-center justify-center rounded-lg border border-white/10 bg-white/5 text-slate-200 shadow-soft backdrop-blur-[24px] backdrop-saturate-150 transition hover:bg-white/10 active:bg-white/15"
											title="Copy to clipboard"
											aria-label="Copy to clipboard"
											data-i18n-title="editor.copy"
											data-i18n-aria="editor.copy">
										<svg
											viewBox="0 0 24 24"
											fill="none"
											stroke="currentColor"
											stroke-width="2"
											stroke-linecap="round"
											stroke-linejoin="round"
											class="h-4 w-4">
											<rect x="9" y="9" width="13" height="13" rx="2" />
											<path
												d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
										</svg>
									</button>
									<button
										id="toggleBlockArrange"
										type="button"
										class="absolute bottom-2 z-30 inline-flex h-9 w-9 items-center justify-center rounded-lg border border-white/10 bg-white/5 text-slate-200 shadow-soft backdrop-blur-[24px] backdrop-saturate-150 transition hover:bg-white/10 active:bg-white/15"
										style="right: 140px"
										title="Blöcke anordnen"
										aria-label="Blöcke anordnen"
										data-i18n-title="arrange.toggle"
										data-i18n-aria="arrange.toggle"
										aria-pressed="false">
										<svg
											viewBox="0 0 24 24"
											fill="none"
											stroke="currentColor"
											stroke-width="2"
											stroke-linecap="round"
											stroke-linejoin="round"
											class="h-4 w-4">
											<rect x="3" y="3" width="7" height="7" rx="1" />
											<rect x="14" y="3" width="7" height="7" rx="1" />
											<rect x="3" y="14" width="7" height="7" rx="1" />
											<path d="M14 17h7" />
											<path d="M17.5 14v6" />
										</svg>
									</button>
										<button
											id="togglePermanentLink"
											type="button"
											class="absolute bottom-2 z-30 inline-flex h-9 w-9 items-center justify-center rounded-lg border border-white/10 bg-white/5 text-slate-200 shadow-soft backdrop-blur-[24px] backdrop-saturate-150 transition hover:bg-white/10 active:bg-white/15"
											style="right: 184px"
											title="Permanent-Link"
											aria-label="Permanent-Link"
											aria-pressed="false"
											data-i18n-title="editor.permalink"
											data-i18n-aria="editor.permalink">
											<svg
												viewBox="0 0 24 24"
												fill="none"
												stroke="currentColor"
												stroke-width="2"
												stroke-linecap="round"
												stroke-linejoin="round"
												class="h-4 w-4">
												<circle cx="12" cy="7" r="3" />
												<path d="M12 10v8" />
												<path d="M5 14a7 7 0 0 0 14 0" />
												<path d="M8 18l-3-3" />
												<path d="M16 18l3-3" />
											</svg>
										</button>
									<button
										id="toggleExcalidraw"
										type="button"
										class="absolute bottom-2 z-30 inline-flex h-9 w-9 items-center justify-center rounded-lg border border-white/10 bg-white/5 text-slate-200 shadow-soft backdrop-blur-[24px] backdrop-saturate-150 transition hover:bg-white/10 active:bg-white/15"
										style="right: 272px"
										title="Excalidraw ein-/ausblenden"
										aria-label="Excalidraw ein-/ausblenden"
										aria-pressed="false">
										<svg
											viewBox="0 0 24 24"
											fill="none"
											stroke="currentColor"
											stroke-width="2"
											stroke-linecap="round"
											stroke-linejoin="round"
											class="h-4 w-4">
											<path d="M14.5 17.5 3 6l3-3 11.5 11.5" />
											<path d="M13 19l2.5-2.5" />
											<path d="M18 22l3-3" />
											<path d="M2 7l3-3" />
											<path d="M10 14l-4 4" />
										</svg>
									</button>
									<button
										id="toggleLinear"
										type="button"
										class="absolute bottom-2 z-30 inline-flex h-9 w-9 items-center justify-center rounded-lg border border-white/10 bg-white/5 text-slate-200 shadow-soft backdrop-blur-[24px] backdrop-saturate-150 transition hover:bg-white/10 active:bg-white/15"
										style="right: 316px"
										title="Linear Aufgaben ein-/ausblenden"
										aria-label="Linear Aufgaben ein-/ausblenden"
										aria-pressed="false">
										<svg
											viewBox="0 0 24 24"
											fill="none"
											stroke="currentColor"
											stroke-width="2"
											stroke-linecap="round"
											stroke-linejoin="round"
											class="h-4 w-4">
											<path d="M9 11l2 2 4-4" />
											<rect x="3" y="3" width="18" height="18" rx="2" />
											<path d="M7 7h6" />
											<path d="M7 16h10" />
										</svg>
									</button>
									<button
										id="toggleExcel"
										type="button"
										class="absolute bottom-2 z-30 inline-flex h-9 w-9 items-center justify-center rounded-lg border border-white/10 bg-white/5 text-slate-200 shadow-soft backdrop-blur-[24px] backdrop-saturate-150 transition hover:bg-white/10 active:bg-white/15"
										style="right: 228px"
										title="Tabelle ein-/ausblenden"
										aria-label="Tabelle ein-/ausblenden"
										aria-pressed="false">
										<svg
											viewBox="0 0 24 24"
											fill="none"
											stroke="currentColor"
											stroke-width="2"
											stroke-linecap="round"
											stroke-linejoin="round"
											class="h-4 w-4">
											<rect x="3" y="3" width="18" height="18" rx="2" />
											<path d="M3 9h18" />
											<path d="M3 15h18" />
											<path d="M9 3v18" />
											<path d="M15 3v18" />
										</svg>
									</button>
											<button
												id="toggleComments"
												type="button"
												class="absolute bottom-2 left-2 z-10 inline-flex h-9 w-9 items-center justify-center rounded-lg border border-white/10 bg-white/5 text-slate-200 shadow-soft backdrop-blur-[24px] backdrop-saturate-150 transition hover:bg-white/10 active:bg-white/15"
											title="Kommentare ein-/ausblenden"
											aria-label="Kommentare ein-/ausblenden"
											data-i18n-title="comments.toggle"
											data-i18n-aria="comments.toggle"
												aria-pressed="false">
												<svg
													viewBox="0 0 24 24"
													fill="none"
													stroke="currentColor"
													stroke-width="2"
													stroke-linecap="round"
													stroke-linejoin="round"
													class="h-4 w-4">
													<path d="M21 15a4 4 0 0 1-4 4H7l-4 3v-3a4 4 0 0 1-4-4V7a4 4 0 0 1 4-4h14a4 4 0 0 1 4 4z" />
												</svg>
													<span
														id="commentCountBadge"
														class="comment-badge absolute -top-1 -right-1 hidden min-w-[18px] rounded-full border border-white/10 px-1.5 py-0.5 text-[10px] font-semibold shadow-soft">
														0
													</span>
											</button>
											<div
												id="commentPanel"
												class="absolute right-2 top-20 bottom-2 hidden flex w-[min(92vw,420px)] flex-col overflow-hidden rounded-xl border border-white/10 bg-slate-950/90 shadow-soft backdrop-blur">
												<div class="flex items-center justify-between border-b border-white/10 px-3 py-2">
													<div class="text-xs font-semibold text-slate-200" data-i18n="comments.title">Kommentare</div>
													<button
														id="commentClose"
														type="button"
														class="inline-flex h-7 w-7 items-center justify-center rounded-md border border-white/10 bg-white/5 text-slate-300 transition hover:bg-white/10"
														title="Schließen"
														aria-label="Schließen"
														data-i18n-title="comments.close"
														data-i18n-aria="comments.close">
														<svg
															viewBox="0 0 24 24"
															fill="none"
															stroke="currentColor"
															stroke-width="2"
															stroke-linecap="round"
															stroke-linejoin="round"
															class="h-3.5 w-3.5">
															<path d="M18 6L6 18" />
															<path d="M6 6l12 12" />
														</svg>
													</button>
												</div>
														<div id="commentList" class="flex-1 overflow-y-auto p-3 space-y-2"></div>
												<div id="commentEmpty" class="px-3 pb-2 text-[11px] text-slate-400" data-i18n="comments.empty">
													Noch keine Kommentare.
												</div>
												<div class="border-t border-white/10 p-3">
													<div id="commentSelectionLabel" class="mb-2 text-[11px] text-slate-400"></div>
													<label for="commentInput" class="sr-only" data-i18n="comments.input_label">Comment</label>
													<div class="comment-input-wrap relative">
														<textarea
															id="commentInput"
															class="comment-input min-h-[72px] w-full resize-none rounded-lg border border-white/10 bg-slate-950/40 px-3 py-2 text-sm text-slate-100 shadow-inner outline-none focus:ring-2 focus:ring-fuchsia-400/30"
															placeholder="Comment (Markdown)"
															data-i18n-placeholder="comments.input_placeholder"></textarea>
														<div class="comment-input-toolbar" role="toolbar" aria-label="Markdown">
															<button
																id="commentMdBold"
																type="button"
																class="comment-md-btn"
																title="Fett"
																aria-label="Fett">
																<span class="text-[11px] font-semibold">B</span>
															</button>
															<button
																id="commentMdItalic"
																type="button"
																class="comment-md-btn"
																title="Kursiv"
																aria-label="Kursiv">
																<span class="text-[11px] font-semibold italic">I</span>
															</button>
															<button
																id="commentMdCode"
																type="button"
																class="comment-md-btn"
																title="Codeblock"
																aria-label="Codeblock">
																<span class="text-[11px] font-semibold">&lt;/&gt;</span>
															</button>
														</div>
														<button
															id="commentAdd"
															type="button"
															class="comment-add-btn inline-flex h-9 w-9 items-center justify-center rounded-lg border border-fuchsia-400/30 bg-fuchsia-500/15 text-slate-100 transition hover:bg-fuchsia-500/20"
															data-i18n-title="comments.add_action"
															data-i18n-aria="comments.add_action">
															<svg
																viewBox="0 0 24 24"
																fill="none"
																stroke="currentColor"
																stroke-width="2"
																stroke-linecap="round"
																stroke-linejoin="round"
																class="h-4 w-4">
																<path d="M12 5v14" />
																<path d="M5 12h14" />
															</svg>
															<span id="commentAddLabel" class="sr-only" data-i18n="comments.add_action">
																Kommentar hinzufügen
															</span>
														</button>
													</div>
												</div>
											</div>
											<div
												id="blockArrangeOverlay"
												class="block-arrange-overlay"
												aria-hidden="true">
												<div class="block-arrange-header">
													<div class="block-arrange-title" data-i18n="arrange.title">Blöcke anordnen</div>
													<div class="block-arrange-toolbar">
														<label class="block-arrange-outline-label">
															<input type="checkbox" id="blockArrangeOutline" />
															<span data-i18n="arrange.outline">Nur Überschriften</span>
														</label>
														<button
															id="blockArrangeUndo"
															type="button"
															class="block-arrange-btn"
															disabled
															data-i18n="arrange.undo">Rückgängig</button>
													</div>
													<button
														id="blockArrangeClose"
														type="button"
														class="block-arrange-close"
														title="Schließen"
														aria-label="Schließen"
														data-i18n-title="arrange.close"
														data-i18n-aria="arrange.close">
														<svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4">
															<path d="M18 6L6 18" />
															<path d="M6 6l12 12" />
														</svg>
													</button>
												</div>
												<div class="block-arrange-hint" data-i18n="arrange.hint">Ziehen zum Verschieben · Alt+↑↓ mit Tastatur</div>
												<div id="blockArrangeList" class="block-arrange-list"></div>
												<div id="blockArrangeEmpty" class="block-arrange-empty hidden" data-i18n="arrange.empty">Keine Blöcke gefunden.</div>
												<div class="block-arrange-footer">
													<button
														id="blockArrangeCancel"
														type="button"
														class="block-arrange-btn"
														data-i18n="arrange.cancel">Abbrechen</button>
													<button
														id="blockArrangeApply"
														type="button"
														class="block-arrange-btn block-arrange-btn-primary"
														data-i18n="arrange.apply">Übernehmen</button>
												</div>
											</div>
								</div>
								<div
									class="mt-3 flex flex-wrap items-center justify-between gap-2">
									<div class="flex items-center gap-2">
										<button
											id="psNavBack"
											type="button"
											class="inline-flex h-9 w-9 items-center justify-center rounded-lg border border-white/10 bg-transparent text-slate-300 transition hover:bg-white/5 active:bg-white/10 disabled:pointer-events-none disabled:opacity-40"
											title="Back"
											aria-label="Back"
											data-i18n-title="editor.nav_back"
											data-i18n-aria="editor.nav_back"
											disabled>
											<svg
												viewBox="0 0 24 24"
												fill="none"
												stroke="currentColor"
												stroke-width="2"
												stroke-linecap="round"
												stroke-linejoin="round"
												class="h-4 w-4">
												<path d="M15 18l-6-6 6-6" />
											</svg>
										</button>
										<button
											id="psNavForward"
											type="button"
											class="inline-flex h-9 w-9 items-center justify-center rounded-lg border border-white/10 bg-transparent text-slate-300 transition hover:bg-white/5 active:bg-white/10 disabled:pointer-events-none disabled:opacity-40"
											title="Forward"
											aria-label="Forward"
											data-i18n-title="editor.nav_forward"
											data-i18n-aria="editor.nav_forward"
											disabled>
											<svg
												viewBox="0 0 24 24"
												fill="none"
												stroke="currentColor"
												stroke-width="2"
												stroke-linecap="round"
												stroke-linejoin="round"
												class="h-4 w-4">
												<path d="M9 6l6 6-6 6" />
											</svg>
										</button>
										<button
											id="togglePreview"
											type="button"
											class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-sm text-slate-200 transition hover:bg-white/5 active:bg-white/10">
											<span data-i18n="editor.preview">Preview</span>
										</button>
										<button
											id="openUploadModal"
											type="button"
											class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-sm text-slate-200 transition hover:bg-white/5 active:bg-white/10"
											title="Datei hochladen"
											aria-label="Datei hochladen"
											data-i18n-title="editor.upload"
											data-i18n-aria="editor.upload">
											<span data-i18n="editor.upload">Upload</span>
										</button>
										<button
											id="psSaveMain"
											type="button"
											class="rounded-xl border border-fuchsia-400/30 bg-fuchsia-500/15 px-3 py-2 text-sm font-semibold text-slate-100 shadow-soft transition hover:bg-fuchsia-500/20 active:opacity-90">
											<span data-i18n="editor.save">Save</span>
										</button>
										<span
											id="psAutoSaveStatus"
											class="hidden text-xs text-slate-400"></span>
									</div>
									<div class="flex items-center gap-3 text-xs text-slate-400">
										<span id="metaLeft" data-i18n="editor.ready">Ready.</span>
										<span id="metaRight"></span>
										<span id="psMainHint" class="hidden"></span>
									</div>
								</div>
							</div>
							<div
								id="previewPanel"
								class="hidden h-full min-h-56 sm:min-h-72 overflow-hidden rounded-xl border border-white/10 bg-slate-950/25">
								<div class="flex h-full min-h-0 flex-col">
									<div
										class="flex items-center justify-between gap-2 border-b border-white/10 bg-slate-950/30 px-3 py-2">
										<div class="text-xs font-medium text-slate-200" data-i18n="preview.title">
											Preview
										</div>
										<div class="flex items-center gap-2">
											<button
												id="toggleFullPreview"
												type="button"
												class="hidden lg:inline-flex h-8 items-center justify-center rounded-lg border border-white/10 bg-transparent px-2.5 text-xs text-slate-200 transition hover:bg-white/5 active:bg-white/10"
												title="Full preview"
												aria-label="Full preview"
												data-i18n-title="preview.full"
												data-i18n-aria="preview.full"
												aria-pressed="false">
												<span data-i18n="preview.full">Full preview</span>
											</button>
											<button
												id="previewCloseMobile"
												type="button"
												class="mobile-only inline-flex h-8 w-8 items-center justify-center rounded-lg border border-white/10 bg-white/5 text-xs text-slate-200 transition hover:bg-white/10 active:bg-white/15"
												title="Preview schließen"
												aria-label="Preview schließen"
												data-i18n-title="preview.close"
												data-i18n-aria="preview.close">
												<svg
													viewBox="0 0 24 24"
													fill="none"
													stroke="currentColor"
													stroke-width="2"
													stroke-linecap="round"
													stroke-linejoin="round"
													class="h-4 w-4">
													<path d="M18 6L6 18" />
													<path d="M6 6l12 12" />
												</svg>
											</button>
										</div>
									</div>
									<iframe
										id="mdPreview"
										title="Markdown Preview"
										data-i18n-title="preview.iframe"
										class="min-h-0 flex-1"
										sandbox="allow-popups allow-popups-to-escape-sandbox allow-scripts allow-downloads allow-top-navigation-by-user-activation allow-same-origin"
										referrerpolicy="no-referrer"></iframe>
									<div
										id="aiConversationSection"
										class="border-t border-white/10 bg-slate-950/20 px-3 py-3">
										<div
											id="aiConversationHeader"
											class="flex items-center justify-between gap-2 text-[11px] text-slate-300 cursor-pointer select-none"
											role="button"
											aria-expanded="true"
											aria-controls="aiConversationBody"
											title="AI Conversation ein-/ausklappen">
											<div class="flex items-center gap-2">
												<span
													class="inline-flex h-5 w-5 items-center justify-center rounded-md bg-fuchsia-600/20 text-fuchsia-300">
													<svg
														viewBox="0 0 24 24"
														fill="none"
														stroke="currentColor"
														stroke-width="2"
														stroke-linecap="round"
														stroke-linejoin="round"
														class="h-3.5 w-3.5">
														<path
															d="M21 15a4 4 0 0 1-4 4H8l-5 3V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z" />
													</svg>
												</span>
												<span class="font-medium text-slate-200" data-i18n="preview.ask_claude"
													>Ask Claude</span
												>
											</div>
											<svg id="aiConversationChevron" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="h-4 w-4 transition-transform duration-200">
												<path d="M6 9l6 6 6-6" />
											</svg>
										</div>
										<div id="aiConversationBody" class="mt-2 flex flex-col gap-2">
											<div class="flex flex-wrap items-center gap-2 pr-12">
												<button
													id="aiUsePreviewBtn"
													type="button"
													class="inline-flex h-9 shrink-0 items-center gap-2 whitespace-nowrap rounded-xl border border-fuchsia-400/30 bg-fuchsia-500/20 px-4 text-sm font-semibold text-slate-100 shadow-soft transition hover:bg-fuchsia-500/25 active:opacity-90 focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30"
													title="Preview als Kontext verwenden"
													data-i18n-title="preview.use_context"
													aria-pressed="true">
													<span
														class="inline-block h-2 w-2 rounded-full bg-white/80"></span>
														<span data-i18n="preview.use_context">Preview als Kontext verwenden</span>
												</button>
												<div id="aiModeWrap" class="min-w-[220px]">
													<select
														id="aiMode"
														class="h-9 w-full rounded-lg border border-white/10 bg-slate-950/30 px-2.5 text-xs text-slate-200 shadow-soft backdrop-blur transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30"
														title="AI-Modus"
														data-i18n-title="preview.ai_mode">
														<option value="" selected data-i18n="preview.ai_mode.none">Ohne Vorgabe</option>
														<option value="explain" data-i18n="preview.ai_mode.explain">
															Erklären / Antworten
														</option>
														<option value="fix" data-i18n="preview.ai_mode.fix">Fixen / Korrigieren</option>
														<option value="improve" data-i18n="preview.ai_mode.improve">Verbessern</option>
														<option value="run" data-i18n="preview.ai_mode.run">Code ausführen</option>
														<option value="summarize" data-i18n="preview.ai_mode.summarize">Zusammenfassen</option>
														<option value="image" data-i18n="preview.ai_mode.image">🎨 Bild generieren</option>
													</select>
												</div>
											</div>
											<div
												id="aiChatHistory"
												class="hidden rounded-md border border-white/10 bg-slate-950/30 p-3 text-xs text-slate-200 shadow-soft">
												<div class="mb-2 flex items-center justify-between gap-2">
													<div class="text-[11px] uppercase tracking-wide text-slate-400" data-i18n="preview.chat_history">Chatverlauf</div>
													<button
														id="aiChatClear"
														type="button"
														class="inline-flex h-7 w-7 items-center justify-center rounded-md bg-transparent text-slate-300 transition hover:bg-white/5 active:bg-white/10"
														data-i18n-title="preview.chat_clear"
														title="Chatverlauf leeren">
														<span class="sr-only" data-i18n="preview.chat_clear">Chat leeren</span>
														<svg
															viewBox="0 0 24 24"
															fill="none"
															stroke="currentColor"
															stroke-width="2"
															stroke-linecap="round"
															stroke-linejoin="round"
															class="h-4 w-4">
															<path d="M3 6h18" />
															<path d="M8 6V4h8v2" />
															<path d="M6 6l1 14h10l1-14" />
														</svg>
													</button>
												</div>
												<div id="aiChatList" class="space-y-2"></div>
											</div>
											<div class="flex flex-wrap items-start gap-2">
													<div
														id="aiPromptWrap"
														class="relative min-w-0 flex-1 group">
													<label for="aiPrompt" class="sr-only" data-i18n="preview.ask">Ask</label>
														<textarea
															id="aiPrompt"
															rows="3"
																class="min-h-[86px] w-full min-w-0 resize-none rounded-md border border-white/10 bg-slate-950/30 px-3 py-2 pb-10 pr-12 text-sm text-slate-100 shadow-soft backdrop-blur transition placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30"></textarea>
														<button
															id="aiDictate"
															type="button"
															class="absolute bottom-2 right-2 h-7 w-7 rounded-md border border-transparent bg-transparent text-slate-300 transition hover:text-slate-100 focus:outline-none focus:ring-2 focus:ring-fuchsia-400/40"
															title="Diktat starten"
															aria-label="Diktat starten"
															data-i18n-title="preview.dictate"
															data-i18n-aria="preview.dictate"
															aria-pressed="false">
															<span class="sr-only" data-i18n="preview.dictate_sr">Diktat</span>
															<svg
																viewBox="0 0 24 24"
																fill="none"
																stroke="currentColor"
																stroke-width="2"
																stroke-linecap="round"
																stroke-linejoin="round"
																class="mx-auto h-4 w-4">
																<path d="M12 3a3 3 0 0 1 3 3v5a3 3 0 0 1-6 0V6a3 3 0 0 1 3-3z" />
																<path d="M19 10a7 7 0 0 1-14 0" />
																<path d="M12 17v4" />
																<path d="M8 21h8" />
															</svg>
														</button>
													<button
														id="aiPromptClear"
														type="button"
														class="absolute right-2 top-2 h-7 w-7 rounded-md border border-white/10 bg-slate-950/10 text-sm text-slate-200 opacity-0 transition group-hover:opacity-100 focus:opacity-100 hover:bg-white/5 active:bg-white/10"
														title="Prompt leeren"
														aria-label="Prompt leeren"
														data-i18n-title="preview.prompt_clear"
														data-i18n-aria="preview.prompt_clear">
														×
													</button>
												</div>
													<div class="flex shrink-0 flex-col justify-end gap-2 self-stretch pb-2">
														<button
															id="aiAssist"
															type="button"
															class="h-10 w-10 self-end rounded-xl border border-fuchsia-400/30 bg-fuchsia-500/15 text-slate-100 shadow-soft transition hover:bg-fuchsia-500/20 active:opacity-90 focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30"
															title="Ask"
															data-i18n-title="preview.ask">
															<span class="sr-only" data-i18n="preview.ask">Ask</span>
															<svg
																viewBox="0 0 24 24"
																fill="none"
																stroke="currentColor"
																stroke-width="2"
																stroke-linecap="round"
																stroke-linejoin="round"
																class="mx-auto h-4 w-4">
																<path d="M5 12h12" />
																<path d="M13 6l6 6-6 6" />
															</svg>
														</button>
													</div>
											</div>
											<div
												id="runOutputBar"
												class="hidden flex flex-wrap items-center gap-1.5 rounded-lg border border-white/10 bg-white/5 px-2 py-[5px] text-xs text-slate-200 shadow-soft backdrop-blur-[24px] backdrop-saturate-150">
												<div
													class="flex items-center justify-between gap-2 text-[11px] text-slate-300">
														<div class="sr-only">
															<span id="runOutputTitle">AI</span>
														</div>
														<div class="flex flex-wrap items-center gap-2">
															<span
																id="runOutputIcon"
																class="run-output-icon"
																aria-hidden="true"></span>
															<span id="runStatus" class="text-slate-400"></span>
														<button
															id="applyOutputReplace"
															type="button"
															class="hidden rounded-md border border-white/10 bg-transparent px-2 py-1 text-[11px] text-slate-200 transition hover:bg-white/5 active:bg-white/10"
															title="Replace editor with AI output"
															data-i18n-title="preview.replace_title">
															<span data-i18n="preview.replace">Replace</span>
														</button>
														<button
															id="applyOutputAppend"
															type="button"
															class="hidden rounded-md border border-white/10 bg-white/10 px-2 py-1 text-[11px] text-slate-100 transition hover:bg-white/15 active:bg-white/20"
															title="Append AI output to editor"
															data-i18n-title="preview.append_title">
															<span data-i18n="preview.append">Append</span>
														</button>
														<button
															id="clearRunOutput"
															type="button"
															class="hidden rounded-md border border-white/10 bg-transparent px-2 py-1 text-[11px] text-slate-200 transition hover:bg-white/5 active:bg-white/10"
															title="Clear output"
															data-i18n-title="preview.clear_title">
															<span data-i18n="preview.clear">Clear</span>
														</button>
													</div>
												</div>
											</div>
											<pre
												id="runOutput"
												class="mt-2 max-h-40 overflow-auto whitespace-pre-wrap break-words text-[12px] leading-relaxed text-slate-100"></pre>
										</div>
									</div>
								</div>
							</div>
						</div>
						<div
							id="calendarPanel"
								class="hidden flex min-h-0 flex-1 flex-col gap-3">
							<div class="rounded-xl border border-white/10 bg-slate-950/40 p-3 sm:p-4">
								<div class="flex flex-wrap items-center justify-between gap-2">
									<div class="flex items-center gap-2">
										<h3 class="text-sm font-semibold text-slate-100">Kalender</h3>
										<button
											id="calendarFreeToggle"
											type="button"
											class="inline-flex h-8 w-8 items-center justify-center rounded-md border border-white/10 bg-transparent text-slate-300 transition hover:bg-white/5 active:bg-white/10"
											title="Freie Zeiten"
											aria-label="Freie Zeiten"
											aria-pressed="true">
											<svg
												viewBox="0 0 24 24"
												fill="none"
												stroke="currentColor"
												stroke-width="2"
												stroke-linecap="round"
												stroke-linejoin="round"
												class="h-4 w-4">
												<circle cx="12" cy="12" r="9" />
												<path d="M12 7v5l3 3" />
											</svg>
										</button>
									</div>
									<div class="flex items-center gap-1.5">
										<button
											id="calendarPrev"
											type="button"
												class="inline-flex h-8 w-8 items-center justify-center rounded-md border border-white/10 bg-transparent text-slate-300 transition hover:bg-white/5 active:bg-white/10"
											title="Zurück"
											aria-label="Zurück">
											<svg
												viewBox="0 0 24 24"
												fill="none"
												stroke="currentColor"
												stroke-width="2"
												stroke-linecap="round"
												stroke-linejoin="round"
												class="h-4 w-4">
												<path d="M15 18l-6-6 6-6" />
											</svg>
										</button>
										<button
											id="calendarToday"
											type="button"
												class="rounded-md border border-white/10 bg-white/10 px-2.5 py-1.5 text-xs text-slate-100 transition hover:bg-white/15 active:bg-white/20">
											Heute
										</button>
										<button
											id="calendarNext"
											type="button"
												class="inline-flex h-8 w-8 items-center justify-center rounded-md border border-white/10 bg-transparent text-slate-300 transition hover:bg-white/5 active:bg-white/10"
											title="Weiter"
											aria-label="Weiter">
											<svg
												viewBox="0 0 24 24"
												fill="none"
												stroke="currentColor"
												stroke-width="2"
												stroke-linecap="round"
												stroke-linejoin="round"
												class="h-4 w-4">
												<path d="M9 6l6 6-6 6" />
											</svg>
										</button>
											</div>
					</div>
								<div class="mt-2 flex flex-wrap items-center gap-2">
									<div class="inline-flex items-center gap-1 rounded-full border border-white/10 bg-slate-950/40 p-1">
										<button
											data-calendar-view="day"
											type="button"
											class="rounded-full px-2.5 py-1 text-[11px] text-slate-300 transition hover:bg-white/5">
											Tag
										</button>
										<button
											data-calendar-view="week"
											type="button"
											class="rounded-full px-2.5 py-1 text-[11px] text-slate-300 transition hover:bg-white/5">
											Woche
										</button>
										<button
											data-calendar-view="month"
											type="button"
											class="rounded-full px-2.5 py-1 text-[11px] text-slate-300 transition hover:bg-white/5">
											Monat
										</button>
									</div>
									<div class="ml-auto flex flex-wrap items-center gap-2 text-xs text-slate-400">
										<div
											id="calendarWeekLabel"
											class="hidden text-xs font-semibold text-slate-300"></div>
										<div id="calendarTitle" class="text-right text-xs text-slate-400"></div>
									</div>
								</div>
							</div>
							<div
								id="calendarLayout"
								class="relative grid min-h-0 flex-1 gap-3 lg:grid-cols-[minmax(0,1fr)_200px]">
								<button
									id="calendarSidebarToggle"
									type="button"
									class="absolute right-3 top-3 inline-flex h-8 w-8 items-center justify-center rounded-md border border-white/10 bg-slate-950/40 text-slate-300 shadow-soft transition hover:bg-white/5 active:bg-white/10"
									title="Toggle sidebar"
									aria-label="Toggle sidebar"
									aria-expanded="true">
									<svg
										data-role="calendarSidebarChevron"
										viewBox="0 0 24 24"
										fill="none"
										stroke="currentColor"
										stroke-width="2"
										stroke-linecap="round"
										stroke-linejoin="round"
										class="h-3.5 w-3.5 transition">
										<path d="M9 18l6-6-6-6" />
									</svg>
								</button>
								<div
									id="calendarGrid"
									class="h-full min-h-0 overflow-auto rounded-xl border border-white/10 bg-slate-950/30 p-3"></div>
								<div
									id="calendarSidebar"
									class="rounded-xl border border-white/10 bg-slate-950/30 p-3">
									<div class="flex items-center justify-between gap-2">
										<div class="text-xs text-slate-400">Kalender</div>
									</div>
									<div id="calendarLegend" class="mt-2 space-y-2"></div>
									<div id="calendarStatus" class="mt-3 text-[11px] text-slate-500"></div>
									<div
										id="calendarFreeSlotsWrap"
										class="mt-3 rounded-lg border border-white/10 bg-slate-950/40 p-2">
										<div class="text-[11px] font-semibold text-slate-300">
											Freie Zeiten
										</div>
										<div
											id="calendarFreeSlots"
											class="mt-2 space-y-1 text-[11px] text-slate-300"></div>
									</div>
									<div class="mt-3 flex flex-col gap-2">
										<button
											id="calendarAddEvent"
											type="button"
											class="rounded-lg border border-white/10 bg-white/10 px-3 py-2 text-xs text-slate-100 transition hover:bg-white/15 active:bg-white/20">
											Neuen Termin
										</button>
										<button
											id="calendarRefresh"
											type="button"
											class="rounded-lg border border-white/10 bg-white/10 px-3 py-2 text-xs text-slate-100 transition hover:bg-white/15 active:bg-white/20">
											Aktualisieren
										</button>
										<button
											id="calendarOpenSettings"
											type="button"
											class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-xs text-slate-200 transition hover:bg-white/5 active:bg-white/10">
											Einstellungen öffnen
										</button>
									</div>
								</div>
							</div>
						</div>
					</div>
				</section>
			</div>
		</main>

		<!-- App Modals (prompt/confirm replacement) -->
		<div
			id="tableModal"
			class="fixed inset-0 z-[200] hidden items-center justify-center p-4"
			aria-hidden="true">
			<div
				data-role="tableModalBackdrop"
				class="absolute inset-0 bg-slate-950/70 backdrop-blur-sm"></div>
			<div
				role="dialog"
				aria-modal="true"
				aria-labelledby="tableModalTitle"
				class="relative w-full max-w-4xl overflow-hidden rounded-2xl border border-white/10 bg-slate-950/70 shadow-soft backdrop-blur">
				<div class="border-b border-white/10 px-5 py-4">
					<div class="flex items-center justify-between gap-3">
						<div>
							<h3
								id="tableModalTitle"
								class="text-base font-semibold text-slate-100">
								Table editor
							</h3>
							<p class="mt-1 text-xs text-slate-400">
								Edit cells, add/remove rows and columns, and insert
								calculations.
							</p>
						</div>
						<button
							id="tableModalClose"
							type="button"
							class="rounded-lg border border-white/10 bg-transparent px-2 py-1 text-xs text-slate-200 transition hover:bg-white/5 active:bg-white/10"
							aria-label="Close">
							Esc
						</button>
					</div>
					<div class="mt-3 flex flex-wrap items-center gap-2">
						<button
							id="tableAddRow"
							type="button"
							class="rounded-lg border border-white/10 bg-white/10 px-3 py-1.5 text-xs text-slate-100 transition hover:bg-white/15 active:bg-white/20">
							+ Row
						</button>
						<button
							id="tableDelRow"
							type="button"
							class="rounded-lg border border-white/10 bg-transparent px-3 py-1.5 text-xs text-slate-200 transition hover:bg-white/5 active:bg-white/10">
							- Row
						</button>
						<button
							id="tableAddCol"
							type="button"
							class="rounded-lg border border-white/10 bg-white/10 px-3 py-1.5 text-xs text-slate-100 transition hover:bg-white/15 active:bg-white/20">
							+ Column
						</button>
						<button
							id="tableDelCol"
							type="button"
							class="rounded-lg border border-white/10 bg-transparent px-3 py-1.5 text-xs text-slate-200 transition hover:bg-white/5 active:bg-white/10">
							- Column
						</button>
						<span class="ml-auto text-xs text-slate-500" id="tableActiveCell">
							Cell: —
						</span>
					</div>
				</div>
				<div class="grid gap-4 p-5 lg:grid-cols-[1fr_260px]">
					<div
						id="tableGridWrap"
						class="max-h-[60vh] overflow-auto rounded-xl border border-white/10 bg-slate-950/40 p-3 shadow-inner"></div>
					<div class="rounded-xl border border-white/10 bg-slate-950/40 p-4">
						<div class="text-xs font-semibold text-slate-200">Calculations</div>
						<div class="mt-3 flex flex-col gap-2 text-xs text-slate-300">
							<label class="flex items-center gap-2">
								<span class="w-16 text-slate-400">Scope</span>
								<select
									id="tableCalcScope"
									class="h-8 flex-1 rounded-lg border border-white/10 bg-slate-950/60 px-2 text-xs text-slate-100">
									<option value="col">Column</option>
									<option value="row">Row</option>
								</select>
							</label>
							<label class="flex items-center gap-2">
								<span class="w-16 text-slate-400">Index</span>
								<input
									id="tableCalcIndex"
									type="number"
									min="1"
									value="1"
									class="h-8 w-full rounded-lg border border-white/10 bg-slate-950/60 px-2 text-xs text-slate-100" />
							</label>
							<div class="mt-2 grid gap-2 text-xs">
								<div class="flex items-center justify-between">
									<span class="text-slate-400">Sum</span>
									<span id="tableCalcSum" class="text-slate-100">—</span>
								</div>
								<div class="flex items-center justify-between">
									<span class="text-slate-400">Avg</span>
									<span id="tableCalcAvg" class="text-slate-100">—</span>
								</div>
								<div class="flex items-center justify-between">
									<span class="text-slate-400">Max</span>
									<span id="tableCalcMax" class="text-slate-100">—</span>
								</div>
								<div class="flex items-center justify-between">
									<span class="text-slate-400">Min</span>
									<span id="tableCalcMin" class="text-slate-100">—</span>
								</div>
							</div>
							<div class="mt-3 grid grid-cols-2 gap-2">
								<button
									id="tableInsertSum"
									type="button"
									class="rounded-lg border border-white/10 bg-white/10 px-2 py-1.5 text-xs text-slate-100 transition hover:bg-white/15 active:bg-white/20">
									Insert Sum
								</button>
								<button
									id="tableInsertAvg"
									type="button"
									class="rounded-lg border border-white/10 bg-white/10 px-2 py-1.5 text-xs text-slate-100 transition hover:bg-white/15 active:bg-white/20">
									Insert Avg
								</button>
								<button
									id="tableInsertMax"
									type="button"
									class="rounded-lg border border-white/10 bg-white/10 px-2 py-1.5 text-xs text-slate-100 transition hover:bg-white/15 active:bg-white/20">
									Insert Max
								</button>
								<button
									id="tableInsertMin"
									type="button"
									class="rounded-lg border border-white/10 bg-white/10 px-2 py-1.5 text-xs text-slate-100 transition hover:bg-white/15 active:bg-white/20">
									Insert Min
								</button>
							</div>
							<p class="mt-3 text-[11px] text-slate-500">
								Only numeric cells are used. Click a cell to set the target for
								insert.
							</p>
						</div>
					</div>
				</div>
				<div
					class="flex items-center justify-end gap-2 border-t border-white/10 bg-slate-950/30 px-5 py-3">
					<button
						id="tableModalCancel"
						type="button"
						class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-sm text-slate-200 transition hover:bg-white/5 active:bg-white/10">
						Cancel
					</button>
					<button
						id="tableModalApply"
						type="button"
						class="rounded-lg border border-white/10 bg-white/10 px-3 py-2 text-sm font-medium text-slate-100 transition hover:bg-white/15 active:bg-white/20">
						Apply
					</button>
				</div>
			</div>
		</div>

		<div
			id="settingsRoot"
			class="fixed inset-0 z-[200] hidden items-center justify-center p-4"
			aria-hidden="true">
			<div
				id="settingsBackdrop"
				class="absolute inset-0 bg-slate-950/70 backdrop-blur-sm"></div>
			<div
				id="settingsPanel"
				role="dialog"
				aria-modal="true"
				aria-labelledby="settingsTitle"
				class="relative flex h-full max-h-[86vh] w-full max-w-4xl flex-col overflow-hidden rounded-2xl border border-white/10 bg-slate-950/70 shadow-soft backdrop-blur">
				<header
					class="flex items-center justify-between border-b border-white/10 px-5 py-4">
					<div>
						<h3
							id="settingsTitle"
							class="text-base font-semibold text-slate-100"
							data-i18n="settings.title">
							Settings
						</h3>
						<p class="mt-1 text-xs text-slate-400" data-i18n="settings.desc">
							Manage account, export/import, themes, AI, and help.
						</p>
						<div class="mt-1 flex items-center gap-3 text-xs text-slate-400">
							<span
								id="buildStamp"
								title="Build info"
								aria-label="Build info"
								data-i18n-title="settings.build"
								data-i18n-aria="settings.build"></span>
							<span
								id="syncStamp"
								class="opacity-60"
								title="Last server sync"
								aria-label="Last server sync"></span>
						</div>
					</div>
					<button
						id="settingsClose"
						type="button"
						class="rounded-lg border border-white/10 bg-transparent px-2.5 py-1.5 text-xs text-slate-200 transition hover:bg-white/5 active:bg-white/10"
						aria-label="Close settings"
						data-i18n-aria="settings.close">
						Esc
					</button>
				</header>
				<div class="flex min-h-0 flex-1 flex-col sm:flex-row">
					<nav
						id="settingsNav"
						class="flex shrink-0 flex-row gap-2 overflow-x-auto border-b border-white/10 px-4 py-3 sm:w-56 sm:flex-col sm:border-b-0 sm:border-r sm:px-3 sm:py-4">
						<button
							type="button"
							data-settings-nav="user"
							class="rounded-lg border border-white/10 bg-white/10 px-3 py-2 text-left text-xs text-slate-100 transition hover:bg-white/15"
							data-i18n="settings.nav.user">
							User Settings
						</button>
						<button
							type="button"
							data-settings-nav="export"
							class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-left text-xs text-slate-200 transition hover:bg-white/5"
							data-i18n="settings.nav.export">
							Export/Import
						</button>
						<button
							type="button"
							data-settings-nav="shared"
							class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-left text-xs text-slate-200 transition hover:bg-white/5"
							data-i18n="settings.nav.shared">
							Shared Rooms
						</button>
						<button
							type="button"
							data-settings-nav="themes"
							class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-left text-xs text-slate-200 transition hover:bg-white/5"
							data-i18n="settings.nav.themes">
							Themes
						</button>
						<button
							type="button"
							data-settings-nav="calendar"
							class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-left text-xs text-slate-200 transition hover:bg-white/5"
							data-i18n="settings.nav.calendar">
							Kalender
						</button>
							<button
								type="button"
								data-settings-nav="integrations"
								class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-left text-xs text-slate-200 transition hover:bg-white/5"
								data-i18n="settings.nav.integrations">
								Integrationen
							</button>
						<button
							type="button"
							data-settings-nav="ai"
							class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-left text-xs text-slate-200 transition hover:bg-white/5"
							data-i18n="settings.nav.ai">
							AI
						</button>
							<button
									type="button"
									data-settings-nav="uploads"
									class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-left text-xs text-slate-200 transition hover:bg-white/5"
									data-i18n="settings.nav.uploads">
									Uploads
							</button>
						<button
							type="button"
							data-settings-nav="shortcuts"
							class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-left text-xs text-slate-200 transition hover:bg-white/5"
							data-i18n="settings.nav.shortcuts">
							Tastenkürzel
						</button>
						<button
							type="button"
							data-settings-nav="faq"
							class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-left text-xs text-slate-200 transition hover:bg-white/5"
							data-i18n="settings.nav.faq">
							FAQ
						</button>
						<button
							type="button"
							data-settings-nav="trash"
							class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-left text-xs text-slate-200 transition hover:bg-white/5"
							data-i18n="settings.nav.trash">
							Trash
						</button>
					</nav>
					<div class="min-h-0 flex-1 overflow-y-auto px-5 py-4">
						<section data-settings-section="user" class="space-y-3">
							<div>
								<h4 class="text-sm font-semibold text-slate-100" data-i18n="settings.user.title">
									User Settings
								</h4>
								<p class="mt-1 text-xs text-slate-400" data-i18n="settings.user.desc">
									Personal Space identity and sign-out.
								</p>
							</div>
							<div
								id="psUserAuthed"
								class="hidden rounded-xl border border-white/10 bg-white/5 p-3">
								<div class="text-xs text-slate-300">
									<span data-i18n="settings.user.signed_in">Signed in as</span>
									<span id="psEmail" class="font-medium text-slate-100"></span>
								</div>
								<button
									id="psLogout"
									type="button"
									class="mt-3 rounded-lg border border-white/10 bg-transparent px-3 py-2 text-xs text-slate-200 transition hover:bg-white/5 active:bg-white/10">
									<span data-i18n="settings.user.sign_out">Sign out</span>
								</button>
							</div>
							<div
								id="psUserUnauthed"
								class="rounded-xl border border-white/10 bg-slate-950/40 p-3 text-xs text-slate-400"
								data-i18n="settings.user.signed_out">
								Not signed in. Use "Add Personal Space" to get started.
							</div>
							<div class="rounded-xl border border-white/10 bg-white/5 p-3">
								<div class="text-xs font-semibold text-slate-200" data-i18n="settings.user.favorites.title">
									Favoriten
								</div>
								<p class="mt-1 text-xs text-slate-400" data-i18n="settings.user.favorites.desc">
									Favoriten bearbeiten, Notizen hinzufügen oder entfernen.
								</p>
								<div id="favoritesManageEmpty" class="mt-2 text-xs text-slate-400" data-i18n="settings.user.favorites.empty">
									Keine Favoriten vorhanden.
								</div>
								<div id="favoritesManageList" class="mt-2 space-y-2"></div>
							</div>
							<div class="rounded-xl border border-white/10 bg-white/5 p-3">
								<div class="text-xs font-semibold text-slate-200" data-i18n="settings.user.mobile_auto.title">
									Mobile: Neue Notiz nach Inaktivität
								</div>
								<p class="mt-1 text-xs text-slate-400" data-i18n="settings.user.mobile_auto.desc">
									Nach wie vielen Sekunden Inaktivität beim nächsten App-Start eine neue Notiz erstellt wird.
								</p>
								<div class="mt-2 flex items-center gap-2">
									<input
										id="mobileAutoNoteSeconds"
										type="number"
										min="0"
										step="1"
										class="w-28 rounded-lg border border-white/10 bg-slate-950/30 px-3 py-2 text-xs text-slate-200 shadow-soft backdrop-blur transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30"
										placeholder="0" />
									<span class="text-xs text-slate-400" data-i18n="settings.user.mobile_auto.unit">Sekunden (0 = aus)</span>
								</div>
							</div>
							<div class="rounded-xl border border-white/10 bg-white/5 p-3">
								<div class="text-xs font-semibold text-slate-200" data-i18n="settings.language.title">
									App language
								</div>
								<p class="mt-1 text-xs text-slate-400" data-i18n="settings.language.desc">
									Choose the interface language.
								</p>
								<div class="mt-2 flex flex-wrap items-center gap-2">
									<button
										id="uiLangDe"
										type="button"
										class="rounded-lg border border-white/10 bg-white/5 px-3 py-2 text-xs text-slate-200 transition hover:bg-white/10 active:bg-white/15"
										aria-pressed="false"
										data-i18n="settings.language.de">
										Deutsch
									</button>
									<button
										id="uiLangEn"
										type="button"
										class="rounded-lg border border-white/10 bg-white/5 px-3 py-2 text-xs text-slate-200 transition hover:bg-white/10 active:bg-white/15"
										aria-pressed="false"
										data-i18n="settings.language.en">
										English
									</button>
								</div>
							</div>
							<div class="rounded-xl border border-white/10 bg-white/5 p-3">
								<div class="text-xs font-semibold text-slate-200" data-i18n="settings.datetime.title">
									Datum &amp; Zeit
								</div>
								<p class="mt-1 text-xs text-slate-400" data-i18n="settings.datetime.desc">
									Format für Datum und Uhrzeit im Personal Space.
								</p>
								<div class="mt-2 grid gap-3 sm:grid-cols-2">
									<div>
										<label for="settingsDateFormat" class="text-xs text-slate-300" data-i18n="settings.datetime.date_label">
											Datumsformat
										</label>
										<select
											id="settingsDateFormat"
											class="mt-1 w-full rounded-lg border border-white/10 bg-slate-950/30 px-3 py-2 text-sm text-slate-200 shadow-soft backdrop-blur transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30">
											<option value="locale" data-i18n="settings.datetime.date_auto">System</option>
											<option value="dmy" data-i18n="settings.datetime.date_dmy">TT.MM.JJJJ</option>
											<option value="ymd" data-i18n="settings.datetime.date_ymd">JJJJ-MM-TT</option>
											<option value="mdy" data-i18n="settings.datetime.date_mdy">MM/TT/JJJJ</option>
										</select>
									</div>
									<div>
										<label for="settingsTimeFormat" class="text-xs text-slate-300" data-i18n="settings.datetime.time_label">
											Zeitformat
										</label>
										<select
											id="settingsTimeFormat"
											class="mt-1 w-full rounded-lg border border-white/10 bg-slate-950/30 px-3 py-2 text-sm text-slate-200 shadow-soft backdrop-blur transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30">
											<option value="locale" data-i18n="settings.datetime.time_auto">System</option>
											<option value="24h" data-i18n="settings.datetime.time_24h">24h</option>
											<option value="12h" data-i18n="settings.datetime.time_12h">12h AM/PM</option>
										</select>
									</div>
								</div>
							</div>
							<div class="rounded-xl border border-white/10 bg-white/5 p-3">
								<div class="text-xs font-semibold text-slate-200" data-i18n="settings.tasks.title">
									Markdown-Aufgaben
								</div>
								<p class="mt-1 text-xs text-slate-400" data-i18n="settings.tasks.desc">
									Offene Aufgaben beim Schließen der Vorschau automatisch nach oben sortieren.
								</p>
								<label class="mt-2 inline-flex items-center gap-2 text-xs text-slate-200">
									<input
										id="taskAutoSort"
										type="checkbox"
										class="h-4 w-4 rounded border-white/20 bg-slate-950/40 text-fuchsia-400 focus:ring-fuchsia-400/40" />
									<span data-i18n="settings.tasks.auto_sort">Offene Einträge zuerst</span>
								</label>
							</div>
						</section>

						<section data-settings-section="shared" class="hidden space-y-3">
							<div>
								<h4 class="text-sm font-semibold text-slate-100" data-i18n="settings.shared.title">
									Shared Rooms
								</h4>
								<p class="mt-1 text-xs text-slate-400" data-i18n="settings.shared.desc">
									Manage and remove shared rooms.
								</p>
							</div>
							<div class="rounded-xl border border-white/10 bg-white/5 p-3">
								<div class="flex items-center justify-between gap-2">
									<div class="text-xs font-semibold text-slate-200" data-i18n="settings.shared.title">
										Shared Rooms
									</div>
									<button
										id="sharedRoomsClear"
										type="button"
										class="rounded-lg border border-white/10 bg-transparent px-3 py-1.5 text-xs text-slate-200 transition hover:bg-white/5 active:bg-white/10"
										data-i18n="settings.shared.clear">
										Remove all
									</button>
								</div>
								<div class="mt-2">
									<input
										id="sharedRoomsFilter"
										type="search"
										class="w-full rounded-lg border border-white/10 bg-slate-950/30 px-3 py-2 text-xs text-slate-200 shadow-soft backdrop-blur transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30"
										placeholder="Search shared rooms"
										data-i18n-placeholder="settings.shared.search_placeholder" />
								</div>
								<div id="sharedRoomsManageEmpty" class="mt-2 text-xs text-slate-400" data-i18n="settings.shared.empty">
									No shared rooms saved.
								</div>
								<div id="sharedRoomsManageList" class="mt-2 space-y-2"></div>
							</div>
						</section>

						<section data-settings-section="export" class="hidden space-y-3">
							<div>
								<h4 class="text-sm font-semibold text-slate-100" data-i18n="settings.export.title">
									Export/Import
								</h4>
								<p class="mt-1 text-xs text-slate-400" data-i18n="settings.export.desc">
									Back up or import your Personal Space notes.
								</p>
							</div>
							<div class="flex flex-wrap items-center gap-2">
								<button
									id="psExportNotes"
									type="button"
									class="rounded-lg border border-white/10 bg-white/5 px-3 py-2 text-xs text-slate-200 transition hover:bg-white/10 active:bg-white/15"
									data-i18n="settings.export.export">
									Export
								</button>
								<select
									id="psImportMode"
									class="rounded-lg border border-white/10 bg-slate-950/30 px-2.5 py-2 text-xs text-slate-200 shadow-soft backdrop-blur transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30">
									<option value="merge" selected data-i18n="settings.export.merge">Merge</option>
									<option value="replace" data-i18n="settings.export.replace">Replace</option>
								</select>
								<button
									id="psImportNotes"
									type="button"
									class="rounded-lg border border-white/10 bg-white/5 px-3 py-2 text-xs text-slate-200 transition hover:bg-white/10 active:bg-white/15"
									data-i18n="settings.export.import">
									Import
								</button>
								<input
									id="psImportFile"
									type="file"
									accept="application/json,text/markdown,text/plain,.json,.md,.markdown,.txt"
									class="hidden" />
							</div>
							<div id="psTransferHint" class="text-xs text-slate-400"></div>
							<div class="rounded-xl border border-white/10 bg-white/5 p-3">
								<div class="text-xs font-semibold text-slate-200" data-i18n="settings.export.autobackup.title">Auto-Backup</div>
								<p class="mt-1 text-xs text-slate-400" data-i18n="settings.export.autobackup.desc">
									Sichert deine Personal Space Notizen regelmäßig in einen lokalen Ordner.
								</p>
								<div class="mt-2 flex flex-wrap items-center gap-2">
									<label class="inline-flex items-center gap-2 text-xs text-slate-200">
										<input
											id="psAutoBackupEnabled"
											type="checkbox"
											class="h-4 w-4 rounded border-white/20 bg-slate-950/40 text-fuchsia-400 focus:ring-fuchsia-400/40" />
										<span data-i18n="settings.export.autobackup.active">Aktiv</span>
									</label>
									<select
										id="psAutoBackupInterval"
										class="rounded-lg border border-white/10 bg-slate-950/30 px-2.5 py-1.5 text-xs text-slate-200 shadow-soft backdrop-blur transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30">
										<option value="daily" selected data-i18n="settings.export.autobackup.daily">Täglich</option>
										<option value="weekly" data-i18n="settings.export.autobackup.weekly">Wöchentlich</option>
										<option value="monthly" data-i18n="settings.export.autobackup.monthly">Monatlich</option>
									</select>
									<button
										id="psAutoBackupFolder"
										type="button"
										class="rounded-lg border border-white/10 bg-white/5 px-3 py-1.5 text-xs text-slate-200 transition hover:bg-white/10 active:bg-white/15"
										data-i18n="settings.export.autobackup.choose_folder">
										Ordner wählen
									</button>
									<span id="psAutoBackupFolderLabel" class="text-xs text-slate-400">
										<span data-i18n="settings.export.autobackup.no_folder">Kein Ordner gewählt</span>
									</span>
								</div>
								<div id="psAutoBackupStatus" class="mt-2 text-xs text-slate-400"></div>
								<div id="psAutoBackupUnsupported" class="mt-2 hidden text-xs text-amber-300" data-i18n="settings.export.autobackup.unsupported">
									Nicht verfügbar (Browser unterstützt keinen Ordnerzugriff).
								</div>
							</div>
							<div class="rounded-xl border border-white/10 bg-white/5 p-3">
								<div class="text-xs font-semibold text-slate-200" data-i18n="settings.export.autoimport.title">Auto-Import</div>
								<p class="mt-1 text-xs text-slate-400" data-i18n="settings.export.autoimport.desc">
									Importiert neue JSON/Markdown-Dateien aus einem Ordner (Merge).
								</p>
								<div class="mt-2 flex flex-wrap items-center gap-2">
									<label class="inline-flex items-center gap-2 text-xs text-slate-200">
										<input
											id="psAutoImportEnabled"
											type="checkbox"
											class="h-4 w-4 rounded border-white/20 bg-slate-950/40 text-fuchsia-400 focus:ring-fuchsia-400/40" />
										<span data-i18n="settings.export.autoimport.active">Aktiv</span>
									</label>
									<select
										id="psAutoImportInterval"
										class="rounded-lg border border-white/10 bg-slate-950/30 px-2.5 py-1.5 text-xs text-slate-200 shadow-soft backdrop-blur transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30">
										<option value="daily" selected data-i18n="settings.export.autoimport.daily">Täglich</option>
										<option value="weekly" data-i18n="settings.export.autoimport.weekly">Wöchentlich</option>
										<option value="monthly" data-i18n="settings.export.autoimport.monthly">Monatlich</option>
									</select>
									<button
										id="psAutoImportFolder"
										type="button"
										class="rounded-lg border border-white/10 bg-white/5 px-3 py-1.5 text-xs text-slate-200 transition hover:bg-white/10 active:bg-white/15"
										data-i18n="settings.export.autoimport.choose_folder">
										Ordner wählen
									</button>
									<span id="psAutoImportFolderLabel" class="text-xs text-slate-400">
										<span data-i18n="settings.export.autoimport.no_folder">Kein Ordner gewählt</span>
									</span>
								</div>
								<div id="psAutoImportStatus" class="mt-2 text-xs text-slate-400"></div>
								<div id="psAutoImportUnsupported" class="mt-2 hidden text-xs text-amber-300" data-i18n="settings.export.autoimport.unsupported">
									Nicht verfügbar (Browser unterstützt keinen Ordnerzugriff).
								</div>
							</div>
						</section>

						<section data-settings-section="calendar" class="hidden space-y-3">
							<div>
								<h4 class="text-sm font-semibold text-slate-100" data-i18n="settings.calendar.title">Kalender</h4>
								<p class="mt-1 text-xs text-slate-400" data-i18n="settings.calendar.desc">
									Kalender verbinden und Standardansicht festlegen.
								</p>
							</div>
							<div class="grid gap-3 sm:grid-cols-2">
								<div>
									<label for="calendarDefaultView" class="text-xs text-slate-300" data-i18n="settings.calendar.default_view">
										Standardansicht
									</label>
									<select
										id="calendarDefaultView"
										class="mt-1 w-full rounded-lg border border-white/10 bg-slate-950/30 px-3 py-2 text-sm text-slate-200 shadow-soft backdrop-blur transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30">
										<option value="day" data-i18n="settings.calendar.view.day">Tag</option>
										<option value="week" data-i18n="settings.calendar.view.week">Woche</option>
										<option value="month" data-i18n="settings.calendar.view.month">Monat</option>
									</select>
								</div>
							</div>
							<div class="rounded-xl border border-white/10 bg-white/5 p-3">
								<div class="text-xs font-semibold text-slate-200" data-i18n="settings.calendar.sources.title">
									Kalenderquellen
								</div>
								<p class="mt-1 text-xs text-slate-400" data-i18n="settings.calendar.sources.desc">
									Füge öffentliche ICS-Links hinzu (CORS muss erlaubt sein).
								</p>
								<div id="calendarSourcesEmpty" class="mt-2 text-xs text-slate-400" data-i18n="settings.calendar.sources.empty">
									Keine Kalender verbunden.
								</div>
								<div id="calendarSourcesList" class="mt-3 space-y-2"></div>
							</div>
							<div class="rounded-xl border border-white/10 bg-white/5 p-3">
								<div class="text-xs font-semibold text-slate-200" data-i18n="settings.calendar.local.title">
									Lokale Termine
								</div>
								<p class="mt-1 text-xs text-slate-400" data-i18n="settings.calendar.local.desc">
									Manuell angelegte Termine werden lokal gespeichert und mit Personal Space synchronisiert (falls aktiv).
								</p>
								<div id="calendarLocalEventsEmpty" class="mt-2 text-xs text-slate-400" data-i18n="settings.calendar.local.empty">
									Keine lokalen Termine.
								</div>
								<div id="calendarLocalEventsList" class="mt-3 space-y-2"></div>
							</div>
							<div class="rounded-xl border border-white/10 bg-white/5 p-3">
								<div class="text-xs font-semibold text-slate-200" data-i18n="settings.calendar.google.title">
									Google Calendar
								</div>
								<p class="mt-1 text-xs text-slate-400" data-i18n="settings.calendar.google.desc">
									Verbinde deinen Google Kalender, um Termine zu schreiben.
								</p>
								<div id="calendarGoogleStatus" class="mt-2 text-xs text-slate-400" data-i18n="settings.calendar.google.status_disconnected">
									Nicht verbunden.
								</div>
								<div class="mt-3">
									<label for="calendarGoogleSelect" class="text-xs text-slate-300" data-i18n="settings.calendar.google.select">
										Kalender auswählen
									</label>
									<select
										id="calendarGoogleSelect"
										disabled
										class="mt-1 w-full rounded-lg border border-white/10 bg-slate-950/30 px-3 py-2 text-sm text-slate-200 shadow-soft backdrop-blur transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30">
										<option value="primary" data-i18n="settings.calendar.google.primary">Primary</option>
									</select>
								</div>
								<div class="mt-3 flex flex-wrap items-center gap-2">
									<button
										id="calendarGoogleConnect"
										type="button"
										class="rounded-lg border border-white/10 bg-white/10 px-3 py-2 text-xs text-slate-100 transition hover:bg-white/15 active:bg-white/20"
										data-i18n="settings.calendar.google.connect">
										Google verbinden
									</button>
									<button
										id="calendarGoogleDisconnect"
										type="button"
										class="hidden rounded-lg border border-white/10 bg-transparent px-3 py-2 text-xs text-slate-200 transition hover:bg-white/5 active:bg-white/10"
										data-i18n="settings.calendar.google.disconnect">
										Trennen
									</button>
								</div>
							</div>
							<div class="rounded-xl border border-white/10 bg-white/5 p-3">
								<div class="text-xs font-semibold text-slate-200" data-i18n="settings.calendar.outlook.title">
									Outlook Calendar
								</div>
								<p class="mt-1 text-xs text-slate-400" data-i18n="settings.calendar.outlook.desc">
									Verbinde deinen Outlook Kalender, um Termine zu schreiben.
								</p>
								<div id="calendarOutlookStatus" class="mt-2 text-xs text-slate-400" data-i18n="settings.calendar.outlook.status_disconnected">
									Nicht verbunden.
								</div>
								<div class="mt-3">
									<label for="calendarOutlookSelect" class="text-xs text-slate-300" data-i18n="settings.calendar.outlook.select">
										Kalender auswählen
									</label>
									<select
										id="calendarOutlookSelect"
										disabled
										class="mt-1 w-full rounded-lg border border-white/10 bg-slate-950/30 px-3 py-2 text-sm text-slate-200 shadow-soft backdrop-blur transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30">
										<option value="primary" data-i18n="settings.calendar.outlook.primary">Default</option>
									</select>
								</div>
								<div class="mt-3 flex flex-wrap items-center gap-2">
									<button
										id="calendarOutlookConnect"
										type="button"
										class="rounded-lg border border-white/10 bg-white/10 px-3 py-2 text-xs text-slate-100 transition hover:bg-white/15 active:bg-white/20"
										data-i18n="settings.calendar.outlook.connect">
										Outlook verbinden
									</button>
									<button
										id="calendarOutlookDisconnect"
										type="button"
										class="hidden rounded-lg border border-white/10 bg-transparent px-3 py-2 text-xs text-slate-200 transition hover:bg-white/5 active:bg-white/10"
										data-i18n="settings.calendar.outlook.disconnect">
										Trennen
									</button>
								</div>
							</div>
							<div class="rounded-xl border border-white/10 bg-slate-950/40 p-3">
								<div class="text-xs font-semibold text-slate-200" data-i18n="settings.calendar.add.title">
									Neuen Kalender hinzufügen
								</div>
								<div class="mt-2 grid gap-2 sm:grid-cols-2">
									<div>
										<label for="calendarAddName" class="text-xs text-slate-300" data-i18n="settings.calendar.add.name">
											Name
										</label>
										<input
											id="calendarAddName"
											type="text"
											placeholder="Team, Privat, Urlaub"
											data-i18n-placeholder="settings.calendar.add.name_placeholder"
											class="mt-1 w-full rounded-lg border border-white/10 bg-slate-950/30 px-3 py-2 text-sm text-slate-100 shadow-soft backdrop-blur transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30" />
									</div>
									<div>
										<label for="calendarAddColor" class="text-xs text-slate-300" data-i18n="settings.calendar.add.color">
											Farbe
										</label>
										<input
											id="calendarAddColor"
											type="color"
											value="#a855f7"
											class="mt-1 h-10 w-full rounded-lg border border-white/10 bg-slate-950/30" />
									</div>
									<div class="sm:col-span-2">
										<label for="calendarAddUrl" class="text-xs text-slate-300" data-i18n="settings.calendar.add.url">
											ICS-URL
										</label>
										<input
											id="calendarAddUrl"
											type="url"
											placeholder="https://example.com/calendar.ics"
											data-i18n-placeholder="settings.calendar.add.url_placeholder"
											class="mt-1 w-full rounded-lg border border-white/10 bg-slate-950/30 px-3 py-2 text-sm text-slate-100 shadow-soft backdrop-blur transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30" />
									</div>
									<label class="flex items-center gap-2 text-xs text-slate-300">
										<input
											id="calendarAddEnabled"
											type="checkbox"
											checked
											class="h-4 w-4 rounded border-white/20 bg-slate-950/40 text-fuchsia-400" />
										<span data-i18n="settings.calendar.add.active">Aktiv</span>
									</label>
									<div class="sm:col-span-2">
										<button
											id="calendarAddBtn"
											type="button"
											class="rounded-lg border border-white/10 bg-white/10 px-3 py-2 text-xs text-slate-100 transition hover:bg-white/15 active:bg-white/20"
											data-i18n="settings.calendar.add.submit">
											Hinzufügen
										</button>
									</div>
								</div>
							</div>
						</section>

						<section data-settings-section="integrations" class="hidden space-y-3">
							<div>
								<h4 class="text-sm font-semibold text-slate-100" data-i18n="settings.integrations.title">
									Integrationen
								</h4>
								<p class="mt-1 text-xs text-slate-400" data-i18n="settings.integrations.desc">
									App-Integrationen verwalten (API-Keys serverseitig verschlüsselt).
								</p>
							</div>
							<div class="rounded-xl border border-white/10 bg-white/5 p-3">
								<div class="text-xs font-semibold text-slate-200" data-i18n="settings.integrations.linear.title">
									Linear
								</div>
								<p class="mt-1 text-xs text-slate-400" data-i18n="settings.integrations.linear.desc">
									API-Key verschlüsselt im Personal Space speichern und Projekte für die Freigabe auswählen.
								</p>
								<div class="mt-3 grid gap-3 sm:grid-cols-2">
									<div class="sm:col-span-2">
										<label for="linearApiKey" class="text-xs text-slate-300" data-i18n="settings.integrations.linear.key_label">
											Linear API-Key
										</label>
										<input
											id="linearApiKey"
											type="password"
											placeholder="lin_api_..."
											class="mt-1 w-full rounded-lg border border-white/10 bg-slate-950/30 px-3 py-2 text-sm text-slate-100 shadow-soft backdrop-blur transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30" />
									</div>
									<div class="flex items-end gap-2 sm:col-span-2">
										<button
											id="linearApiSave"
											type="button"
											class="rounded-lg border border-white/10 bg-white/10 px-3 py-2 text-xs text-slate-100 transition hover:bg-white/15 active:bg-white/20"
											data-i18n="settings.integrations.linear.save">
											Speichern
										</button>
										<button
											id="linearApiClear"
											type="button"
											class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-xs text-slate-200 transition hover:bg-white/5 active:bg-white/10"
											data-i18n="settings.integrations.linear.clear">
											Löschen
										</button>
										<button
											id="linearLoadProjects"
											type="button"
											class="rounded-lg border border-white/10 bg-white/10 px-3 py-2 text-xs text-slate-100 transition hover:bg-white/15 active:bg-white/20"
											data-i18n="settings.integrations.linear.load">
											Projekte laden
										</button>
									</div>
								</div>
								<div id="linearApiStatus" class="mt-2 text-xs text-slate-400"></div>
								<div class="mt-3 rounded-lg border border-white/10 bg-slate-950/40 p-3">
									<div class="text-xs font-semibold text-slate-200" data-i18n="settings.integrations.linear.projects.title">
										Projekte für Raumfreigabe
									</div>
									<p class="mt-1 text-xs text-slate-400" data-i18n="settings.integrations.linear.projects.desc">
										Wähle die Projekte, die im Raum geteilt werden dürfen.
									</p>
									<div id="linearProjectsEmpty" class="mt-2 text-xs text-slate-400" data-i18n="settings.integrations.linear.projects.empty">
										Keine Projekte geladen.
									</div>
									<div id="linearProjectsList" class="mt-2 space-y-2"></div>
								</div>
							</div>
							<div class="rounded-xl border border-white/10 bg-white/5 p-3">
								<div class="text-xs font-semibold text-slate-200" data-i18n="settings.integrations.bfl.title">
									FLUX.2 (BFL)
								</div>
								<p class="mt-1 text-xs text-slate-400" data-i18n="settings.integrations.bfl.desc">
									BFL API-Key verschlüsselt im Personal Space speichern für AI-Bildgenerierung.
								</p>
								<p class="mt-1 text-xs text-slate-500">
									<a href="https://api.bfl.ai/" target="_blank" rel="noopener noreferrer"
										class="text-fuchsia-400/80 underline decoration-fuchsia-400/30 underline-offset-2 transition hover:text-fuchsia-300 hover:decoration-fuchsia-300/50"
										data-i18n="settings.integrations.bfl.api_link">→ API-Key erstellen auf api.bfl.ai</a>
								</p>
								<div class="mt-3 grid gap-3 sm:grid-cols-2">
									<div class="sm:col-span-2">
										<label for="bflApiKey" class="text-xs text-slate-300" data-i18n="settings.integrations.bfl.key_label">
											BFL API-Key
										</label>
										<input
											id="bflApiKey"
											type="password"
											placeholder="bfl_..."
											class="mt-1 w-full rounded-lg border border-white/10 bg-slate-950/30 px-3 py-2 text-sm text-slate-100 shadow-soft backdrop-blur transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30" />
									</div>
									<div class="flex items-end gap-2 sm:col-span-2">
										<button
											id="bflApiSave"
											type="button"
											class="rounded-lg border border-white/10 bg-white/10 px-3 py-2 text-xs text-slate-100 transition hover:bg-white/15 active:bg-white/20"
											data-i18n="settings.integrations.bfl.save">
											Speichern
										</button>
										<button
											id="bflApiClear"
											type="button"
											class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-xs text-slate-200 transition hover:bg-white/5 active:bg-white/10"
											data-i18n="settings.integrations.bfl.clear">
											Löschen
										</button>
									</div>
								</div>
								<div id="bflApiStatus" class="mt-2 text-xs text-slate-400"></div>
							</div>
						</section>

						<section data-settings-section="trash" class="hidden space-y-3">
							<div>
								<h4 class="text-sm font-semibold text-slate-100" data-i18n="settings.trash.title">
									Trash
								</h4>
								<p class="mt-1 text-xs text-slate-400" data-i18n="settings.trash.desc">
									Deleted notes are kept for 30 days and can be restored.
								</p>
							</div>
							<div class="flex items-center gap-2">
								<button
									id="trashRefresh"
									type="button"
									class="rounded-lg border border-white/10 bg-white/10 px-3 py-2 text-xs text-slate-100 transition hover:bg-white/15 active:bg-white/20"
									data-i18n="settings.trash.refresh">
									Refresh
								</button>
							</div>
							<div id="trashManageEmpty" class="text-xs text-slate-400" data-i18n="settings.trash.empty">
								No deleted notes.
							</div>
							<div id="trashManageList" class="space-y-2"></div>
						</section>

						<section data-settings-section="themes" class="hidden space-y-3">
							<div>
								<h4 class="text-sm font-semibold text-slate-100" data-i18n="settings.themes.title">Themes</h4>
								<p class="mt-1 text-xs text-slate-400" data-i18n="settings.themes.desc">
									Choose a background style. Stored locally.
								</p>
							</div>
							<div class="space-y-3">
								<div
									class="flex items-center justify-between gap-3 rounded-lg border border-white/10 bg-white/5 px-3 py-2">
									<div>
										<div class="text-xs font-medium text-slate-200" data-i18n="settings.themes.glow.title">
											Background Glow
										</div>
										<div class="text-[11px] text-slate-400" data-i18n="settings.themes.glow.desc">
											Enable or disable the theme glow.
										</div>
									</div>
									<button
										id="settingsGlowToggle"
										type="button"
										class="inline-flex items-center rounded-lg border border-white/10 bg-white/5 px-3 py-1.5 text-xs text-slate-200 transition hover:bg-white/10"
										aria-pressed="true"
										data-i18n="settings.themes.glow_on">
										Glow on
									</button>
								</div>
								<div id="settingsThemeList" class="grid gap-2 sm:grid-cols-2"></div>
							</div>
						</section>

						<section data-settings-section="ai" class="hidden space-y-3">
							<div>
								<h4 class="text-sm font-semibold text-slate-100" data-i18n="settings.ai.title">AI</h4>
								<p class="mt-1 text-xs text-slate-400" data-i18n="settings.ai.desc">
									API key is stored locally and used per request.
								</p>
							</div>
							<div class="grid gap-3 sm:grid-cols-2">
								<div class="sm:col-span-2">
									<label for="aiApiKey" class="text-xs text-slate-300" data-i18n="settings.ai.key_label">
										Anthropic API-Key
									</label>
									<input
										id="aiApiKey"
										type="password"
										placeholder="sk-ant-..."
										class="mt-1 w-full rounded-lg border border-white/10 bg-slate-950/30 px-3 py-2 text-sm text-slate-100 shadow-soft backdrop-blur transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30" />
								</div>
								<div>
									<label for="aiApiModel" class="text-xs text-slate-300" data-i18n="settings.ai.model_label">
										Model (optional)
									</label>
									<input
										id="aiApiModel"
										type="text"
										list="aiApiModelList"
										placeholder="claude-sonnet-4-20250514"
										class="mt-1 w-full rounded-lg border border-white/10 bg-slate-950/30 px-3 py-2 text-sm text-slate-100 shadow-soft backdrop-blur transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30" />
									<datalist id="aiApiModelList">
										<option value="claude-sonnet-4-20250514">Claude Sonnet 4 (aktuell)</option>
										<option value="claude-3-5-sonnet-latest">Claude 3.5 Sonnet (latest alias)</option>
										<option value="claude-3-5-haiku-latest">Claude 3.5 Haiku (latest alias)</option>
										<option value="claude-3-opus-latest">Claude 3 Opus (latest alias)</option>
									</datalist>
								</div>
								<div class="flex items-end gap-2">
									<button
										id="aiApiSave"
										type="button"
										class="rounded-lg border border-white/10 bg-white/10 px-3 py-2 text-xs text-slate-100 transition hover:bg-white/15 active:bg-white/20"
										data-i18n="settings.ai.save">
										Save
									</button>
									<button
										id="aiApiClear"
										type="button"
										class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-xs text-slate-200 transition hover:bg-white/5 active:bg-white/10"
										data-i18n="settings.ai.clear">
										Clear
									</button>
								</div>
							</div>
							<div id="aiApiStatus" class="text-xs text-slate-400"></div>
						</section>

						<section data-settings-section="shortcuts" class="hidden space-y-3">
							<div>
								<h4 class="text-sm font-semibold text-slate-100" data-i18n="settings.shortcuts.title">Tastenkürzel</h4>
								<p class="mt-1 text-xs text-slate-400" data-i18n="settings.shortcuts.desc">
									Übersicht aller Tastenkombinationen für schnellen Zugriff.
								</p>
							</div>
							<div id="shortcutsList" class="space-y-2"></div>
						</section>

						<section data-settings-section="faq" class="hidden space-y-3">
							<div>
								<h4 class="text-sm font-semibold text-slate-100" data-i18n="settings.faq.title">FAQ</h4>
								<p class="mt-1 text-xs text-slate-400" data-i18n="settings.faq.desc">
									Quick answers and tips.
								</p>
							</div>
							<div class="max-w-md">
								<label for="faqSearch" class="sr-only" data-i18n="settings.faq.search_label">Search FAQ</label>
								<input
									id="faqSearch"
									type="search"
									placeholder="Search…"
									data-i18n-placeholder="settings.faq.search_placeholder"
									class="w-full rounded-lg border border-white/10 bg-slate-950/30 px-3 py-2 text-sm text-slate-200 shadow-soft backdrop-blur transition placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30" />
							</div>
							<div id="faqList" class="space-y-3"></div>
						</section>

						<section data-settings-section="uploads" class="hidden space-y-3">
							<div>
								<h4 class="text-sm font-semibold text-slate-100" data-i18n="settings.uploads.title">Uploads</h4>
								<p class="mt-1 text-xs text-slate-400" data-i18n="settings.uploads.desc">
									Manage uploaded files.
								</p>
							</div>
							<div class="flex items-center gap-2">
								<button
									id="uploadsRefresh"
									type="button"
									class="rounded-lg border border-white/10 bg-white/10 px-3 py-2 text-xs text-slate-100 transition hover:bg-white/15 active:bg-white/20"
									data-i18n="settings.uploads.refresh">
									Refresh
								</button>
							</div>
							<div id="uploadsManageEmpty" class="text-xs text-slate-400" data-i18n="settings.uploads.empty">
								Keine Uploads vorhanden.
							</div>
							<div id="uploadsManageList" class="space-y-2"></div>
						</section>
					</div>
				</div>
			</div>
		</div>

			<div
				id="toastRoot"
				style="position: fixed; right: 16px; bottom: 16px; z-index: 210; display: flex; flex-direction: column; gap: 8px; max-width: 320px; pointer-events: none;"></div>

		<div
			id="modalRoot"
			class="fixed inset-0 z-[200] hidden items-center justify-center p-4"
			aria-hidden="true">
			<div
				data-role="modalBackdrop"
				class="absolute inset-0 bg-slate-950/70 backdrop-blur-sm"></div>
			<div
				role="dialog"
				aria-modal="true"
				aria-labelledby="modalTitle"
				aria-describedby="modalDesc"
				class="relative w-full max-w-md overflow-hidden rounded-2xl border border-white/10 bg-slate-950/70 shadow-soft backdrop-blur">
				<div class="p-5">
					<div class="flex items-start justify-between gap-3">
						<h3 id="modalTitle" class="text-base font-semibold text-slate-100" data-i18n="modal.title">
							Modal
						</h3>
						<button
							id="modalClose"
							type="button"
							class="rounded-lg border border-white/10 bg-transparent px-2 py-1 text-xs text-slate-200 transition hover:bg-white/5 active:bg-white/10"
							aria-label="Close"
							data-i18n-aria="modal.close">
							Esc
						</button>
					</div>
					<p id="modalDesc" class="mt-2 text-sm text-slate-300"></p>
					<div id="modalInputWrap" class="mt-3 hidden">
						<label for="modalInput" class="sr-only" data-i18n="modal.input">Input</label>
						<input
							id="modalInput"
							type="text"
							autocomplete="off"
							class="w-full rounded-xl border border-white/10 bg-slate-950/40 px-3 py-2 text-sm text-slate-100 shadow-inner outline-none ring-1 ring-transparent transition placeholder:text-slate-500 focus:border-white/20 focus:ring-fuchsia-400/25" />
					</div>
				</div>
				<div
					class="flex items-center justify-end gap-2 border-t border-white/10 bg-slate-950/30 px-5 py-3">
					<button
						id="modalCancel"
						type="button"
						class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-sm text-slate-200 transition hover:bg-white/5 active:bg-white/10"
						data-i18n="modal.cancel">
						Cancel
					</button>
					<button
						id="modalOk"
						type="button"
						class="rounded-lg border border-white/10 bg-white/10 px-3 py-2 text-sm font-medium text-slate-100 transition hover:bg-white/15 active:bg-white/20"
						data-i18n="modal.ok">
						OK
					</button>
				</div>
			</div>
		</div>

		<div
			id="calendarEventModal"
			class="fixed inset-0 z-[200] hidden items-center justify-center p-4"
			aria-hidden="true">
			<div
				data-role="calendarEventBackdrop"
				class="absolute inset-0 bg-slate-950/70 backdrop-blur-sm"></div>
			<div
				role="dialog"
				aria-modal="true"
				aria-labelledby="calendarEventTitle"
				class="relative w-full max-w-lg overflow-hidden rounded-2xl border border-white/10 bg-slate-950/70 shadow-soft backdrop-blur">
				<div class="border-b border-white/10 px-5 py-4">
					<div class="flex items-center justify-between gap-3">
						<div>
							<h3
								id="calendarEventTitle"
								class="text-base font-semibold text-slate-100"
								data-i18n="calendar.modal.title">
								Neuen Termin
							</h3>
							<p class="mt-1 text-xs text-slate-400" data-i18n="calendar.modal.desc">
								Einfacher Termin im lokalen Kalender.
							</p>
						</div>
						<button
							id="calendarEventClose"
							type="button"
							class="rounded-lg border border-white/10 bg-transparent px-2.5 py-1.5 text-xs text-slate-200 transition hover:bg-white/5 active:bg-white/10"
							aria-label="Close calendar event modal"
							data-i18n-aria="calendar.modal.close">
							Esc
						</button>
					</div>
				</div>
				<div class="p-5">
					<div class="grid gap-3">
						<div>
								<label for="calendarEventName" class="text-xs text-slate-300" data-i18n="calendar.modal.title_label">
									Titel
								</label>
							<input
								id="calendarEventName"
								type="text"
									placeholder="Termin"
									data-i18n-placeholder="calendar.modal.title_placeholder"
								class="mt-1 w-full rounded-lg border border-white/10 bg-slate-950/30 px-3 py-2 text-sm text-slate-100 shadow-soft backdrop-blur transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30" />
						</div>
						<div class="grid gap-3 sm:grid-cols-2">
							<div>
									<label for="calendarEventDate" class="text-xs text-slate-300" data-i18n="calendar.modal.date">
										Datum
									</label>
								<input
									id="calendarEventDate"
									type="date"
									class="mt-1 w-full rounded-lg border border-white/10 bg-slate-950/30 px-3 py-2 text-sm text-slate-100 shadow-soft backdrop-blur transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30" />
							</div>
							<div class="flex items-end">
									<label class="flex items-center gap-2 text-xs text-slate-300">
									<input
										id="calendarEventAllDay"
										type="checkbox"
										class="h-4 w-4 rounded border-white/20 bg-slate-950/40 text-fuchsia-400" />
										<span data-i18n="calendar.modal.all_day">Ganztägig</span>
								</label>
							</div>
						</div>
						<div class="grid gap-3 sm:grid-cols-2">
							<div>
								<label for="calendarEventStart" class="text-xs text-slate-300" data-i18n="calendar.modal.start">
									Start
								</label>
								<input
									id="calendarEventStart"
									type="time"
									class="mt-1 w-full rounded-lg border border-white/10 bg-slate-950/30 px-3 py-2 text-sm text-slate-100 shadow-soft backdrop-blur transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30" />
							</div>
							<div>
								<label for="calendarEventEnd" class="text-xs text-slate-300" data-i18n="calendar.modal.end">
									Ende
								</label>
								<input
									id="calendarEventEnd"
									type="time"
									class="mt-1 w-full rounded-lg border border-white/10 bg-slate-950/30 px-3 py-2 text-sm text-slate-100 shadow-soft backdrop-blur transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30" />
							</div>
						</div>
						<div>
							<label for="calendarEventLocation" class="text-xs text-slate-300">
								Ort (optional)
							</label>
							<input
								id="calendarEventLocation"
								type="text"
								placeholder="z. B. Office, Call"
								class="mt-1 w-full rounded-lg border border-white/10 bg-slate-950/30 px-3 py-2 text-sm text-slate-100 shadow-soft backdrop-blur transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30" />
						</div>
						<div>
							<label for="calendarEventSyncTarget" class="text-xs text-slate-300" data-i18n="calendar.modal.sync_label">
								Sync-Ziel
							</label>
							<select
								id="calendarEventSyncTarget"
								class="mt-1 w-full rounded-lg border border-white/10 bg-slate-950/30 px-3 py-2 text-sm text-slate-200 shadow-soft backdrop-blur transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30">
								<option value="local" data-i18n="calendar.modal.sync.local">Nur lokal</option>
								<option value="google" data-i18n="calendar.modal.sync.google">Google Calendar</option>
								<option value="outlook" data-i18n="calendar.modal.sync.outlook">Outlook Calendar</option>
							</select>
						</div>
					</div>
					<div class="mt-4 flex items-center justify-end gap-2">
						<button
							id="calendarEventCancel"
							type="button"
							class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-sm text-slate-200 transition hover:bg-white/5 active:bg-white/10">
							Abbrechen
						</button>
						<button
							id="calendarEventSave"
							type="button"
							class="rounded-lg border border-white/10 bg-white/10 px-3 py-2 text-sm font-medium text-slate-100 transition hover:bg-white/15 active:bg-white/20">
							Speichern
						</button>
					</div>
				</div>
			</div>
		</div>

		<div
			id="uploadModal"
			class="fixed inset-0 z-[200] hidden items-center justify-center p-4"
			aria-hidden="true">
			<div
				data-role="uploadModalBackdrop"
				class="absolute inset-0 bg-slate-950/70 backdrop-blur-sm"></div>
			<div
				role="dialog"
				aria-modal="true"
				aria-labelledby="uploadModalTitle"
				class="relative w-full max-w-lg overflow-hidden rounded-2xl border border-white/10 bg-slate-950/70 shadow-soft backdrop-blur">
				<div class="p-5">
					<div class="flex items-start justify-between gap-3">
						<div>
							<h3
								id="uploadModalTitle"
								class="text-base font-semibold text-slate-100">
								Datei hochladen
							</h3>
							<p class="mt-1 text-xs text-slate-400">
								Bilder oder PDFs hochladen und als internen Link einfügen.
							</p>
						</div>
						<button
							id="uploadModalClose"
							type="button"
							class="rounded-lg border border-white/10 bg-transparent px-2.5 py-1.5 text-xs text-slate-200 transition hover:bg-white/5 active:bg-white/10"
							aria-label="Close upload">
							Esc
						</button>
					</div>
					<div class="mt-4 space-y-3">
						<input
							id="uploadFile"
							type="file"
							accept="image/*,application/pdf"
							class="hidden" />
						<button
							id="uploadPick"
							type="button"
							class="rounded-lg border border-white/10 bg-white/10 px-3 py-2 text-xs font-medium text-slate-100 transition hover:bg-white/15 active:bg-white/20">
							Datei auswählen
						</button>
						<div
							class="rounded-xl border border-white/10 bg-slate-950/40 p-3 text-xs">
							<div id="uploadFileName" class="text-slate-200">
								Keine Datei ausgewählt.
							</div>
							<div id="uploadFileMeta" class="mt-1 text-slate-400"></div>
						</div>
					</div>
				</div>
				<div
					class="flex items-center justify-end gap-2 border-t border-white/10 bg-slate-950/30 px-5 py-3">
					<button
						id="uploadCancel"
						type="button"
						class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-sm text-slate-200 transition hover:bg-white/5 active:bg-white/10">
						Cancel
					</button>
					<button
						id="uploadInsert"
						type="button"
						class="rounded-lg border border-white/10 bg-white/10 px-3 py-2 text-sm font-medium text-slate-100 transition hover:bg-white/15 active:bg-white/20">
						Upload & Insert
					</button>
				</div>
			</div>
		</div>

		<div
			id="shareModal"
			class="fixed inset-0 z-[200] hidden items-center justify-center p-4"
			aria-hidden="true">
			<div
				data-role="shareModalBackdrop"
				class="absolute inset-0 bg-slate-950/70 backdrop-blur-sm"></div>
			<div
				role="dialog"
				aria-modal="true"
				aria-labelledby="shareModalTitle"
				class="relative w-full max-w-2xl overflow-hidden rounded-2xl border border-white/10 bg-slate-950/70 shadow-soft backdrop-blur">
				<div class="p-5">
					<div class="flex items-start justify-between gap-3">
						<div>
							<h3
								id="shareModalTitle"
								class="text-base font-semibold text-slate-100">
								Share room
							</h3>
							<p class="mt-1 text-xs text-slate-400">
								Share the room via QR, email, or clipboard.
							</p>
						</div>
						<button
							id="shareModalClose"
							type="button"
							class="rounded-lg border border-white/10 bg-transparent px-2 py-1 text-xs text-slate-200 transition hover:bg-white/5 active:bg-white/10"
							aria-label="Close">
							Esc
						</button>
					</div>

					<div class="mt-4 grid gap-4">
							<div>
								<label for="shareMode" class="text-xs text-slate-400">Share as</label>
								<select
									id="shareMode"
									class="mt-1 inline-block w-auto min-w-[220px] max-w-[320px] rounded-lg border border-white/10 bg-slate-950/40 px-3 py-2 text-center text-sm text-slate-100 outline-none ring-1 ring-transparent transition focus:border-white/20 focus:ring-fuchsia-400/25">
								<option value="private">Private (with key)</option>
								<option value="public">Public (without key)</option>
							</select>
						</div>

						<div>
							<label for="shareModalLink" class="text-xs text-slate-400">Link</label>
							<div class="mt-1 flex flex-wrap items-center gap-2">
								<input
									id="shareModalLink"
									type="text"
									readonly
									class="min-w-0 flex-1 rounded-lg border border-white/10 bg-slate-950/40 px-3 py-2 text-sm text-slate-100 shadow-inner outline-none" />
								<button
									id="shareModalCopy"
									type="button"
									class="rounded-lg border border-white/10 bg-white/10 px-3 py-2 text-sm text-slate-100 transition hover:bg-white/15 active:bg-white/20">
									Copy
								</button>
							</div>
						</div>

						<div class="grid grid-cols-1 gap-3 sm:grid-cols-2">
							<div
								class="rounded-xl border border-white/10 bg-white/5 p-3">
								<div class="text-xs text-slate-400">QR code</div>
								<div
									class="mt-2 flex items-center justify-center rounded-lg bg-slate-950/60 p-3">
									<img
										id="shareModalQr"
										alt="QR Code"
										class="h-40 w-40 rounded-md bg-white" />
								</div>
							</div>
							<div
								class="rounded-xl border border-white/10 bg-white/5 p-3">
								<div class="text-xs text-slate-400">Options</div>
								<div class="mt-2 grid gap-2">
									<button
										id="shareModalShare"
										type="button"
										class="hidden w-full rounded-lg border border-white/10 bg-transparent px-3 py-2 text-center text-sm text-slate-100 transition hover:bg-white/5 active:bg-white/10">
										Share with system
									</button>
									<a
										id="shareModalMail"
										href="#"
										class="w-full rounded-lg border border-white/10 bg-transparent px-3 py-2 text-center text-sm text-slate-100 transition hover:bg-white/5 active:bg-white/10">
										Email
									</a>
									<a
										id="shareModalOpen"
										href="#"
										target="_blank"
										rel="noopener"
										class="w-full rounded-lg border border-white/10 bg-transparent px-3 py-2 text-center text-sm text-slate-100 transition hover:bg-white/5 active:bg-white/10">
										Open in new tab
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div
			id="noteShareModal"
			class="fixed inset-0 z-[200] hidden items-center justify-center p-4"
			aria-hidden="true">
			<div
				data-role="noteShareModalBackdrop"
				class="absolute inset-0 bg-slate-950/70 backdrop-blur-sm"></div>
			<div
				role="dialog"
				aria-modal="true"
				aria-labelledby="noteShareModalTitle"
				class="relative w-full max-w-2xl overflow-hidden rounded-2xl border border-white/10 bg-slate-950/70 shadow-soft backdrop-blur">
				<div class="p-5">
					<div class="flex items-start justify-between gap-3">
						<div>
							<h3
								id="noteShareModalTitle"
								class="text-base font-semibold text-slate-100">
								Share note
							</h3>
							<p id="noteShareModalMeta" class="mt-1 text-xs text-slate-400">
								Share the note via QR, email, or clipboard.
							</p>
						</div>
						<button
							id="noteShareModalClose"
							type="button"
							class="rounded-lg border border-white/10 bg-transparent px-2 py-1 text-xs text-slate-200 transition hover:bg-white/5 active:bg-white/10"
							aria-label="Close">
							Esc
						</button>
					</div>

					<div class="mt-4 grid gap-4">
						<div>
							<label for="noteShareModalText" class="text-xs text-slate-400">Content</label>
							<div class="mt-1 flex flex-wrap items-stretch gap-2">
								<textarea
									id="noteShareModalText"
									rows="6"
									readonly
									class="min-w-0 flex-1 rounded-lg border border-white/10 bg-slate-950/40 px-3 py-2 text-sm text-slate-100 shadow-inner outline-none"></textarea>
								<button
									id="noteShareModalCopy"
									type="button"
									class="self-start rounded-lg border border-white/10 bg-white/10 px-3 py-2 text-sm text-slate-100 transition hover:bg-white/15 active:bg-white/20">
									Copy
								</button>
							</div>
						</div>

						<div class="grid grid-cols-1 gap-3 sm:grid-cols-2">
							<div
								class="rounded-xl border border-white/10 bg-white/5 p-3">
								<div class="text-xs text-slate-400">QR code</div>
								<div
									class="mt-2 flex items-center justify-center rounded-lg bg-slate-950/60 p-3">
									<img
										id="noteShareModalQr"
										alt="QR Code"
										class="h-40 w-40 rounded-md bg-white" />
								</div>
							</div>
							<div
								class="rounded-xl border border-white/10 bg-white/5 p-3">
								<div class="text-xs text-slate-400">Options</div>
								<div class="mt-2 grid gap-2">
									<button
										id="noteShareModalShare"
										type="button"
										class="hidden w-full rounded-lg border border-white/10 bg-transparent px-3 py-2 text-center text-sm text-slate-100 transition hover:bg-white/5 active:bg-white/10">
										Share with system
									</button>
									<a
										id="noteShareModalMail"
										href="#"
										class="w-full rounded-lg border border-white/10 bg-transparent px-3 py-2 text-center text-sm text-slate-100 transition hover:bg-white/5 active:bg-white/10">
										Email
									</a>
									<a
										id="noteShareModalOpen"
										href="#"
										target="_blank"
										rel="noopener"
										class="w-full rounded-lg border border-white/10 bg-transparent px-3 py-2 text-center text-sm text-slate-100 transition hover:bg-white/5 active:bg-white/10">
										Open in new tab
									</a>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<div
			id="psContextMenu"
			class="hidden fixed z-[99999] min-w-[180px] rounded-xl border border-white/10 bg-slate-950/90 p-1 text-xs text-slate-200 shadow-soft backdrop-blur">
			<button
				id="psContextSelect"
				type="button"
				class="flex w-full items-center gap-2 rounded-lg px-2.5 py-2 text-left hover:bg-white/5">
				<span data-role="psContextSelectLabel">Auswählen</span>
			</button>
			<button
				id="psContextSelectAll"
				type="button"
				class="flex w-full items-center gap-2 rounded-lg px-2.5 py-2 text-left hover:bg-white/5">
				<span>Alle auswählen</span>
			</button>
			<button
				id="psContextClear"
				type="button"
				class="flex w-full items-center gap-2 rounded-lg px-2.5 py-2 text-left hover:bg-white/5">
				<span>Auswahl aufheben</span>
			</button>
			<div class="my-1 h-px bg-white/10"></div>
			<button
				id="psContextTags"
				type="button"
				class="flex w-full items-center gap-2 rounded-lg px-2.5 py-2 text-left hover:bg-white/5">
				<span>Tags ändern</span>
			</button>
			<button
				id="psContextShare"
				type="button"
				class="flex w-full items-center gap-2 rounded-lg px-2.5 py-2 text-left hover:bg-white/5">
				<span>Teilen</span>
			</button>
			<button
				id="psContextDelete"
				type="button"
				class="flex w-full items-center gap-2 rounded-lg px-2.5 py-2 text-left text-rose-100 hover:bg-rose-500/20">
				<span>Löschen</span>
			</button>
		</div>

		<div
			id="psTagContextMenu"
			class="hidden fixed z-[99999] min-w-[220px] rounded-xl border border-white/10 bg-slate-950/90 p-1 text-xs text-slate-200 shadow-soft backdrop-blur">
			<div class="px-2.5 py-2">
				<div class="text-[11px] text-slate-400">Tag</div>
				<div
					id="psTagContextLabel"
					class="mt-0.5 text-xs font-semibold text-slate-100"></div>
				<input
					id="psTagContextInput"
					type="text"
					placeholder="Neuer Tagname"
					class="mt-2 w-full rounded-lg border border-white/10 bg-slate-950/40 px-2.5 py-1.5 text-xs text-slate-100 shadow-soft backdrop-blur transition placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30" />
			</div>
			<div class="my-1 h-px bg-white/10"></div>
			<button
				id="psTagContextApply"
				type="button"
				class="flex w-full items-center gap-2 rounded-lg px-2.5 py-2 text-left hover:bg-white/5">
				<span>Umbenennen</span>
			</button>
			<button
				id="psTagContextDelete"
				type="button"
				class="flex w-full items-center gap-2 rounded-lg px-2.5 py-2 text-left text-rose-100 hover:bg-rose-500/20">
				<span>Löschen</span>
			</button>
		</div>

		<!-- Markdown Preview libs (client-side, no build step) -->
		<script defer src="https://cdn.jsdelivr.net/npm/markdown-it@14.1.0/dist/markdown-it.min.js"></script>
		<script defer src="https://cdn.jsdelivr.net/npm/markdown-it-task-lists@2.1.1/dist/markdown-it-task-lists.min.js"></script>
		<script defer src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js"></script>
		<script defer src="/vendor/yjs.bundle.js"></script>
		<script defer src="/app.js?v=2026-02-20-01"></script>
		<script>
			if ("serviceWorker" in navigator) {
				navigator.serviceWorker.register("/sw.js").catch(function (e) {
					console.warn("SW registration failed:", e);
				});
			}
		</script>
	</body>
</html>
