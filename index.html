<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<meta name="color-scheme" content="dark light" />
		<title>Mirror</title>

		<!-- Tailwind (CDN) -->
		<script src="https://cdn.tailwindcss.com"></script>
		<script>
			tailwind.config = {
				theme: {
					extend: {
						fontFamily: {
							sans: [
								"ui-sans-serif",
								"system-ui",
								"-apple-system",
								"Segoe UI",
								"Roboto",
								"Inter",
								"Arial",
								"Noto Sans",
								"sans-serif",
							],
						},
						boxShadow: {
							soft: "0 10px 30px rgba(0,0,0,.25)",
						},
					},
				},
			};
		</script>
		<link
			rel="stylesheet"
			href="https://cdn.jsdelivr.net/npm/highlight.js@11.9.0/styles/github-dark.min.css" />
		<style>
			:root {
				--accent-bg-soft: rgba(217, 70, 239, 0.1);
				--accent-bg: rgba(217, 70, 239, 0.15);
				--accent-bg-hover: rgba(217, 70, 239, 0.2);
				--accent-badge-bg: rgba(217, 70, 239, 0.2);
				--accent-strong: rgba(217, 70, 239, 0.6);
				--accent-strong-hover: rgba(217, 70, 239, 0.7);
				--accent-strong-active: rgba(217, 70, 239, 0.8);
				--accent-border: rgba(217, 70, 239, 0.3);
				--accent-border-strong: rgba(217, 70, 239, 0.4);
				--accent-text: rgba(253, 242, 255, 0.98);
				--accent-text-soft: rgba(244, 114, 182, 0.95);
				--accent-ring: rgba(217, 70, 239, 0.25);
				--accent-ring-strong: rgba(217, 70, 239, 0.4);
				--blockquote-border: rgba(217, 70, 239, 0.45);
				--blockquote-text: rgb(203 213 225);
				--scrollbar-track: rgba(2, 6, 23, 0.35);
				--scrollbar-thumb: rgba(148, 163, 184, 0.25);
				--scrollbar-thumb-hover: rgba(148, 163, 184, 0.4);
			}
			* {
				scrollbar-width: thin;
				scrollbar-color: var(--scrollbar-thumb) transparent;
			}
			*::-webkit-scrollbar {
				width: 10px;
				height: 10px;
			}
			*::-webkit-scrollbar-track {
				background: transparent;
			}
			*::-webkit-scrollbar-thumb {
				background-color: var(--scrollbar-thumb);
				border-radius: 999px;
				border: 2px solid var(--scrollbar-track);
			}
			*::-webkit-scrollbar-thumb:hover {
				background-color: var(--scrollbar-thumb-hover);
			}
			.md-content {
				font-size: 0.875rem;
				line-height: 1.55;
				color: rgb(226 232 240);
			}
			/* Theme overrides for accent utility classes */
			.bg-fuchsia-500\/15 {
				background-color: var(--accent-bg) !important;
			}
			.bg-fuchsia-500\/10 {
				background-color: var(--accent-bg-soft) !important;
			}
			.bg-fuchsia-500\/20 {
				background-color: var(--accent-bg-hover) !important;
			}
			.bg-fuchsia-600\/20 {
				background-color: var(--accent-badge-bg) !important;
			}
			.bg-fuchsia-600\/60 {
				background-color: var(--accent-strong) !important;
			}
			.hover\:bg-fuchsia-500\/20:hover {
				background-color: var(--accent-bg-hover) !important;
			}
			.hover\:bg-fuchsia-600\/70:hover {
				background-color: var(--accent-strong-hover) !important;
			}
			.active\:bg-fuchsia-600\/80:active {
				background-color: var(--accent-strong-active) !important;
			}
			.border-fuchsia-400\/30 {
				border-color: var(--accent-border) !important;
			}
			.border-fuchsia-400\/40 {
				border-color: var(--accent-border-strong) !important;
			}
			.border-fuchsia-500\/30 {
				border-color: var(--accent-border-strong) !important;
			}
			.text-fuchsia-100 {
				color: var(--accent-text) !important;
			}
			.text-fuchsia-300 {
				color: var(--accent-text-soft) !important;
			}
			.ring-fuchsia-400\/25 {
				--tw-ring-color: var(--accent-ring) !important;
			}
			.ring-fuchsia-400\/30 {
				--tw-ring-color: var(--accent-ring) !important;
			}
			.ring-fuchsia-400\/40 {
				--tw-ring-color: var(--accent-ring-strong) !important;
			}
			.focus\:ring-fuchsia-400\/25:focus {
				--tw-ring-color: var(--accent-ring) !important;
			}
			.focus\:ring-fuchsia-400\/30:focus {
				--tw-ring-color: var(--accent-ring) !important;
			}
			.focus\:ring-fuchsia-400\/40:focus {
				--tw-ring-color: var(--accent-ring-strong) !important;
			}
			/* Personal Space: Delete button only on hover (mouse), always on touch */
			.ps-note-delete {
				opacity: 0;
				pointer-events: none;
				transition: opacity 160ms ease, transform 160ms ease;
				transform: translateY(-1px);
			}
			.ps-note-pin {
				opacity: 0;
				pointer-events: none;
				transition: opacity 160ms ease, transform 160ms ease;
				transform: translateY(-1px);
			}
			.ps-note-excerpt {
				overflow: hidden;
				display: -webkit-box;
				-webkit-box-orient: vertical;
				-webkit-line-clamp: 3;
			}
			.group:hover .ps-note-delete,
			.group:focus-within .ps-note-delete {
				opacity: 1;
				pointer-events: auto;
				transform: translateY(0);
			}
			.group:hover .ps-note-pin,
			.group:focus-within .ps-note-pin {
				opacity: 1;
				pointer-events: auto;
				transform: translateY(0);
			}
			@media (hover: none), (pointer: coarse) {
				.ps-note-delete {
					opacity: 1 !important;
					pointer-events: auto !important;
					transform: none !important;
				}
				.ps-note-pin {
					opacity: 1 !important;
					pointer-events: auto !important;
					transform: none !important;
				}
			}
			.md-content a {
				color: rgb(96 165 250);
				text-decoration: underline;
				text-underline-offset: 3px;
			}
			.md-content code,
			.md-content pre {
				font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
					"Liberation Mono", "Courier New", monospace;
			}
			.md-content .pw-field {
				display: inline-flex;
				align-items: center;
				gap: 0.35rem;
				padding: 0.1rem 0.45rem;
				border-radius: 999px;
				border: 1px solid rgba(255, 255, 255, 0.12);
				background: rgba(15, 23, 42, 0.6);
				font-size: 0.85em;
				line-height: 1.2;
			}
			.md-content .pw-mask {
				letter-spacing: 0.18em;
				font-weight: 600;
				color: rgba(226, 232, 240, 0.9);
			}
			.md-content .pw-value {
				display: none;
				font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
					"Liberation Mono", "Courier New", monospace;
				color: rgba(226, 232, 240, 0.95);
			}
			.md-content .pw-field.pw-revealed .pw-mask {
				display: none;
			}
			.md-content .pw-field.pw-revealed .pw-value {
				display: inline;
			}
			.md-content .pw-toggle,
			.md-content .pw-copy {
				display: inline-flex;
				align-items: center;
				justify-content: center;
				height: 1.4rem;
				min-width: 1.4rem;
				padding: 0 0.35rem;
				border-radius: 999px;
				border: 1px solid rgba(255, 255, 255, 0.12);
				background: rgba(255, 255, 255, 0.06);
				color: rgba(226, 232, 240, 0.9);
				font-size: 0.75rem;
				line-height: 1;
				cursor: pointer;
			}
			.md-content .pw-toggle:hover,
			.md-content .pw-copy:hover {
				background: rgba(255, 255, 255, 0.12);
			}
			.md-content pre {
				overflow: auto;
				border: 1px solid rgba(255, 255, 255, 0.08);
				border-radius: 12px;
				padding: 10px;
				background: rgba(2, 6, 23, 0.6);
			}
			.md-content code {
				background: rgba(255, 255, 255, 0.06);
				padding: 0.1em 0.3em;
				border-radius: 0.35em;
			}
			.md-content pre code {
				background: transparent;
				padding: 0;
			}
			.md-content table {
				border-collapse: collapse;
				width: 100%;
			}
			.md-content th,
			.md-content td {
				border: 1px solid rgba(255, 255, 255, 0.12);
				padding: 6px 8px;
			}
			.md-content blockquote {
				border-left: 3px solid var(--blockquote-border);
				margin: 0;
				padding: 0 12px;
				color: var(--blockquote-text);
			}
			.md-content ul.task-list {
				list-style: none;
				padding-left: 0;
			}
			.md-content ul.task-list li {
				display: flex;
				gap: 0.55rem;
				align-items: flex-start;
			}
			/* Keep completed todos visibly marked */
			.md-content ul.task-list li.task-list-item.checked {
				opacity: 0.75;
				text-decoration: line-through;
				text-decoration-thickness: 2px;
				text-decoration-color: rgba(148, 163, 184, 0.7);
			}
			.md-content
				ul.task-list
				li.task-list-item.checked
				input[type="checkbox"] {
				opacity: 1;
			}
			.md-content ul.task-list input[type="checkbox"] {
				margin-top: 0.2rem;
			}
		</style>
	</head>
	<body class="min-h-screen bg-slate-950 text-slate-100 antialiased">
		<div
			id="toastRoot"
			class="pointer-events-none fixed right-4 top-4 z-50 flex w-[min(92vw,420px)] flex-col gap-2"></div>
		<div class="pointer-events-none fixed inset-0 overflow-hidden">
			<div
				id="bgBlobTop"
				class="absolute -top-48 left-1/2 h-[520px] w-[520px] -translate-x-1/2 rounded-full bg-fuchsia-500/15 blur-3xl"></div>
			<div
				id="bgBlobBottom"
				class="absolute -bottom-56 left-1/2 h-[520px] w-[520px] -translate-x-1/2 rounded-full bg-cyan-400/10 blur-3xl"></div>
		</div>

		<main
			class="relative mx-auto my-6 flex h-[calc(100vh-48px)] w-[calc(100vw-48px)] max-w-none items-stretch px-0 py-0 sm:my-5 sm:h-[calc(100vh-40px)] sm:w-[calc(100vw-40px)]">
			<div
				id="mainGrid"
				class="grid h-full w-full grid-cols-1 gap-4 lg:grid-cols-[360px_1fr]">
				<section
					id="psPanel"
					class="flex h-full min-h-0 flex-col overflow-hidden rounded-2xl border border-white/10 bg-white/5 p-4 shadow-soft backdrop-blur sm:p-6">
					<header class="flex items-start justify-between gap-3">
						<div>
							<h2 class="text-sm font-semibold tracking-tight">
								Personal Space
							</h2>
						</div>
					</header>

					<div id="psUnauthed" class="mt-4 flex-1">
						<button
							id="addPersonalSpace"
							type="button"
							class="w-full rounded-lg border border-white/10 bg-white/10 px-3 py-2 text-sm text-slate-100 transition hover:bg-white/15 active:bg-white/20">
							Add Personal Space
						</button>
						<p class="mt-2 text-xs text-slate-400">
							You’ll receive a verification link by email.
						</p>
						<div
							id="psDevLink"
							class="mt-2 hidden rounded-lg border border-white/10 bg-slate-950/30 p-2 text-xs text-slate-200"></div>
					</div>

					<div id="psAuthed" class="mt-4 hidden flex min-h-0 flex-1 flex-col">
						<div class="mt-1">
							<div class="flex items-start gap-3">
								<button
									id="psNewNote"
									type="button"
									class="inline-flex shrink-0 items-center whitespace-nowrap rounded-xl border border-fuchsia-400/30 bg-fuchsia-500/15 px-4 py-2.5 text-sm font-semibold text-slate-100 shadow-soft transition hover:bg-fuchsia-500/20 active:opacity-90">
									New note
								</button>
							</div>
						</div>
						<div id="psHint" class="mt-2 text-xs text-slate-400"></div>

						<div class="mt-4">
							<div class="flex items-center justify-between gap-2">
								<button
									id="psToggleTags"
									type="button"
									class="inline-flex items-center gap-1 text-xs font-medium text-slate-200 transition hover:text-slate-100"
									aria-expanded="true">
									<span>Tags</span>
									<svg
										data-role="chevron"
										viewBox="0 0 24 24"
										fill="none"
										stroke="currentColor"
										stroke-width="2"
										stroke-linecap="round"
										stroke-linejoin="round"
										class="h-4 w-4 text-slate-400 transition-transform">
										<path d="M6 9l6 6 6-6" />
									</svg>
								</button>
								<div id="psTagControls" class="flex items-center gap-2">
									<select
										id="psTagFilterMode"
										class="rounded-lg border border-white/10 bg-slate-950/30 px-2 py-1.5 text-xs text-slate-200 shadow-soft backdrop-blur transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30">
										<option value="and" selected>AND</option>
										<option value="or">OR</option>
									</select>
								</div>
							</div>
							<div id="psTagsPanel" class="mt-2">
								<div class="flex flex-wrap gap-2" id="psTags"></div>
							</div>
						</div>

						<div class="mt-4 flex min-h-0 flex-1 flex-col">
							<div class="flex flex-col gap-2">
								<div class="flex items-center gap-2">
									<div class="text-xs font-medium text-slate-200">Notes</div>
									<div
										id="psCount"
										class="rounded-full border border-white/10 bg-white/5 px-2 py-0.5 text-[11px] text-slate-300"
										title="Number of notes">
										0
									</div>
								</div>
								<div class="flex items-center gap-2">
									<button
										id="psPinnedToggle"
										type="button"
										class="inline-flex h-8 w-8 items-center justify-center rounded-lg border border-white/10 bg-transparent text-slate-300 transition hover:bg-white/5 active:bg-white/10"
										title="Pinned only"
										aria-label="Pinned only"
										aria-pressed="false">
										<svg
											viewBox="0 0 24 24"
											fill="none"
											stroke="currentColor"
											stroke-width="2"
											stroke-linecap="round"
											stroke-linejoin="round"
											class="h-4 w-4">
											<path d="M4 4v16" />
											<path d="M4 4h12l-2 5 2 5H4" />
										</svg>
									</button>
									<div class="relative flex flex-1 items-center gap-2">
										<input
											id="psSearch"
											type="search"
											placeholder="Search…"
											class="w-full min-w-0 rounded-lg border border-white/10 bg-slate-950/30 px-2.5 py-1.5 text-xs text-slate-200 shadow-soft backdrop-blur transition placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30" />
										<button
											id="psSortMenuBtn"
											type="button"
											class="inline-flex h-8 w-8 items-center justify-center rounded-lg border border-white/10 bg-transparent text-slate-300 transition hover:bg-white/5 active:bg-white/10"
											title="Sortierung"
											aria-label="Sortierung"
											aria-expanded="false">
											<svg
												viewBox="0 0 24 24"
												fill="none"
												stroke="currentColor"
												stroke-width="2"
												stroke-linecap="round"
												stroke-linejoin="round"
												class="h-4 w-4">
												<circle cx="12" cy="5" r="1.5" />
												<circle cx="12" cy="12" r="1.5" />
												<circle cx="12" cy="19" r="1.5" />
											</svg>
										</button>
										<div
											id="psSortMenu"
											class="absolute right-0 top-10 z-30 hidden w-48 overflow-hidden rounded-xl border border-white/10 bg-slate-950/80 shadow-soft backdrop-blur">
										<div class="border-b border-white/10 px-3 py-2 text-[11px] text-slate-300">
											Sort by
										</div>
										<div class="flex flex-col gap-1 p-1 text-xs">
											<button
												type="button"
												data-sort="updated"
												class="ps-sort-option flex items-center justify-between rounded-lg px-2.5 py-2 text-left text-slate-200 transition hover:bg-white/5">
												<span>Modified</span>
												<span class="ps-sort-check text-fuchsia-200">✓</span>
											</button>
											<button
												type="button"
												data-sort="created"
												class="ps-sort-option flex items-center justify-between rounded-lg px-2.5 py-2 text-left text-slate-200 transition hover:bg-white/5">
												<span>Created</span>
												<span class="ps-sort-check text-fuchsia-200">✓</span>
											</button>
											<button
												type="button"
												data-sort="accessed"
												class="ps-sort-option flex items-center justify-between rounded-lg px-2.5 py-2 text-left text-slate-200 transition hover:bg-white/5">
												<span>Accessed</span>
												<span class="ps-sort-check text-fuchsia-200">✓</span>
											</button>
											<button
												type="button"
												data-sort="text"
												class="ps-sort-option flex items-center justify-between rounded-lg px-2.5 py-2 text-left text-slate-200 transition hover:bg-white/5">
												<span>Text</span>
												<span class="ps-sort-check text-fuchsia-200">✓</span>
											</button>
										</div>
									</div>
								</div>
							</div>
							<div
								id="psList"
								class="mt-2 flex min-h-0 flex-1 flex-col gap-2 overflow-y-auto pr-1"></div>
						</div>
					</div>
					<div class="mt-auto pt-3">
						<button
							id="psSettingsBtn"
							type="button"
							class="inline-flex h-11 w-11 items-center justify-center rounded-xl border border-white/10 bg-white/5 text-xs text-slate-200 transition hover:bg-white/10 active:bg-white/15"
							aria-label="Open settings"
							title="Settings">
							<svg
								viewBox="0 0 24 24"
								fill="none"
								stroke="currentColor"
								stroke-width="2"
								stroke-linecap="round"
								stroke-linejoin="round"
								class="h-4 w-4">
								<path d="M12 15.5a3.5 3.5 0 1 0 0-7 3.5 3.5 0 0 0 0 7z" />
								<path
									d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 1 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 1 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33H9a1.65 1.65 0 0 0 1-1.51V3a2 2 0 1 1 4 0v.09a1.65 1.65 0 0 0 1 1.51h.09a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9c0 .67.39 1.27 1 1.51H21a2 2 0 1 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z" />
							</svg>
						</button>
					</div>
				</section>

				<section
					class="flex h-full min-h-0 w-full flex-col rounded-2xl border border-white/10 bg-white/5 p-4 sm:p-6 shadow-soft backdrop-blur">
					<header
						class="flex flex-col gap-4 sm:flex-row sm:items-start sm:justify-between">
						<div class="min-w-0">
							<div class="group flex items-center gap-2">
								<div
									id="statusDot"
									class="h-2.5 w-2.5 rounded-full bg-slate-500"></div>
								<h1 class="text-lg font-semibold tracking-tight">Mirror</h1>
								<button
									id="togglePersonalSpace"
									type="button"
									class="ml-1 inline-flex h-8 items-center justify-center gap-1 rounded-lg border border-white/10 bg-transparent px-2.5 text-xs text-slate-200 opacity-0 transition hover:bg-white/5 group-hover:opacity-100 focus-visible:opacity-100 active:bg-white/10"
									title="Toggle Personal Space"
									aria-label="Toggle Personal Space"
									aria-pressed="true">
									<svg
										data-role="psChevron"
										viewBox="0 0 24 24"
										fill="none"
										stroke="currentColor"
										stroke-width="2"
										stroke-linecap="round"
										stroke-linejoin="round"
										class="h-4 w-4 text-slate-300 transition-transform">
										<path d="M14 7l-5 5 5 5" />
									</svg>
								</button>
								<button
									id="toggleHeader"
									type="button"
									class="ml-1 inline-flex h-8 items-center justify-center rounded-lg border border-white/10 bg-transparent px-2 text-xs text-slate-200 opacity-0 transition hover:bg-white/5 group-hover:opacity-100 focus-visible:opacity-100 active:bg-white/10"
									title="Toggle Header"
									aria-label="Toggle Header"
									aria-expanded="true">
									<svg
										data-role="headerChevron"
										viewBox="0 0 24 24"
										fill="none"
										stroke="currentColor"
										stroke-width="2"
										stroke-linecap="round"
										stroke-linejoin="round"
										class="h-4 w-4 text-slate-300 transition-transform">
										<path d="M18 15l-6-6-6 6" />
									</svg>
								</button>
							</div>
							<div data-header-detail="true">
								<div
									id="buildStamp"
									class="mt-1 text-sm text-slate-400"
									title="Build info"
									aria-label="Build info"></div>
								<div class="mt-4 flex flex-wrap items-center gap-2">
								<div class="relative">
									<label for="roomInput" class="sr-only">Room</label>
									<input
										id="roomInput"
										list="roomOptions"
										class="w-44 sm:w-48 rounded-lg border border-white/10 bg-slate-950/40 px-3 py-2 text-sm text-slate-100 placeholder:text-slate-500 outline-none ring-1 ring-transparent transition focus:border-white/20 focus:ring-fuchsia-400/25"
										placeholder="Room (e.g. KubernetesRoom123)" />
									<datalist id="roomOptions"></datalist>
								</div>
								<button
									id="joinRoom"
									type="button"
									class="rounded-lg border border-white/10 bg-white/10 px-3 py-2 text-sm text-slate-100 transition hover:bg-white/15 active:bg-white/20">
									Join
								</button>
								<button
									id="newRoom"
									type="button"
									class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-sm text-slate-200 transition hover:bg-white/5 active:bg-white/10">
									New
								</button>
								<button
									id="copyLink"
									type="button"
									class="rounded-lg border border-white/10 bg-white/10 px-3 py-2 text-sm text-slate-100 transition hover:bg-white/15 active:bg-white/20">
									Copy link
								</button>
								<div class="flex items-center gap-2">
									<label for="favoritesSelect" class="sr-only">Favorites</label>
									<select
										id="favoritesSelect"
										class="w-44 sm:w-56 rounded-lg border border-white/10 bg-slate-950/40 px-3 py-2 text-sm text-slate-100 outline-none ring-1 ring-transparent transition focus:border-white/20 focus:ring-fuchsia-400/25">
										<option value="">Favorites…</option>
									</select>
									<button
										id="toggleFavorite"
										type="button"
										class="inline-flex h-10 w-10 items-center justify-center rounded-lg border border-white/10 bg-white/10 text-slate-100 transition hover:bg-white/15 active:bg-white/20"
										title="Add/remove favorite"
										aria-label="Add/remove favorite">
										<svg
											viewBox="0 0 24 24"
											fill="none"
											stroke="currentColor"
											stroke-width="2"
											stroke-linecap="round"
											stroke-linejoin="round"
											class="h-5 w-5">
											<path
												d="M12 17.3l-6.18 3.25 1.18-6.88L2 8.9l6.9-1L12 1.8l3.1 6.1 6.9 1-5 4.77 1.18 6.88z" />
										</svg>
									</button>
								</div>
							</div>
						</div>
						</div>

						<div
							class="shrink-0 text-left text-xs text-slate-300 sm:text-right">
							<div class="flex items-center justify-end gap-2">
								<div>
									Room:
									<span id="roomLabel" class="font-medium text-slate-100"></span>
								</div>
							</div>
							<div class="mt-1 hidden text-slate-400" id="wsHint" data-header-detail="true"></div>
						</div>
					</header>

					<div class="mt-5 flex min-h-0 flex-1 flex-col sm:mt-6">
						<div
							id="editorPreviewGrid"
							class="grid h-full min-h-0 grid-cols-1 gap-3 lg:grid-cols-1">
							<div class="flex min-h-0 min-w-0 flex-col">
								<label for="mirror" class="sr-only">Text</label>
								<div class="relative flex min-h-0 flex-1">
									<textarea
										id="mirror"
										class="h-full min-h-0 w-full resize-none rounded-xl border border-white/10 bg-slate-950/40 px-4 pt-20 pb-12 pr-11 font-sans text-base leading-relaxed text-slate-100 placeholder:text-slate-500 shadow-inner outline-none ring-1 ring-transparent transition focus:border-white/20 focus:ring-fuchsia-400/25"
										placeholder="Type something — everyone with this link sees it instantly…"
										autocomplete="off"
										spellcheck="false"></textarea>
									<div
										id="slashMenu"
										class="absolute left-2 top-12 z-40 hidden w-[min(92vw,360px)] overflow-hidden rounded-xl border border-white/10 bg-slate-950/80 shadow-soft backdrop-blur">
										<div
											class="border-b border-white/10 px-3 py-2 text-[11px] text-slate-300">
											Slash commands
											<span class="text-slate-500"
												>(Enter/Tab to insert, ↑↓ to navigate)</span
											>
										</div>
										<div
											id="slashMenuList"
											class="max-h-56 overflow-auto p-1"></div>
									</div>
									<div
										id="wikiMenu"
										class="absolute left-2 top-12 z-40 hidden w-[min(92vw,380px)] overflow-hidden rounded-xl border border-white/10 bg-slate-950/80 shadow-soft backdrop-blur">
										<div
											class="border-b border-white/10 px-3 py-2 text-[11px] text-slate-300">
											Notiz-Links
											<span class="text-slate-500"
												>(Enter/Tab to insert, ↑↓ to navigate)</span
											>
										</div>
										<div
											id="wikiMenuList"
											class="max-h-56 overflow-auto p-1"></div>
									</div>
									<div
										id="psMetaOverlay"
										class="pointer-events-none absolute inset-0 overflow-hidden">
										<div
											id="psMetaYaml"
											class="absolute left-2 right-2 top-12 hidden rounded-lg border border-white/10 bg-slate-950/85 px-2 py-1 pr-10 text-[10px] leading-snug text-slate-300 shadow-soft backdrop-blur will-change-transform">
											<pre class="whitespace-pre-wrap font-mono"></pre>
										</div>
									</div>
									<div
										id="selectionMenu"
										class="absolute z-40 hidden min-w-[240px] overflow-hidden rounded-xl border border-white/10 bg-slate-950/85 shadow-soft backdrop-blur">
										<div class="flex flex-wrap items-center gap-1 p-1">
											<button
												type="button"
												data-selection-action="bold"
												class="inline-flex h-8 items-center justify-center rounded-lg border border-white/10 px-2 text-xs text-slate-200 transition hover:bg-white/5"
												title="Bold">
												<strong>B</strong>
											</button>
											<button
												type="button"
												data-selection-action="italic"
												class="inline-flex h-8 items-center justify-center rounded-lg border border-white/10 px-2 text-xs text-slate-200 transition hover:bg-white/5"
												title="Italic">
												<em>I</em>
											</button>
											<button
												type="button"
												data-selection-action="strike"
												class="inline-flex h-8 items-center justify-center rounded-lg border border-white/10 px-2 text-xs text-slate-200 transition hover:bg-white/5"
												title="Strikethrough">
												<span class="line-through">S</span>
											</button>
											<button
												type="button"
												data-selection-action="password"
												class="inline-flex h-8 items-center justify-center rounded-lg border border-white/10 px-2 text-xs text-slate-200 transition hover:bg-white/5"
												title="Passwort verstecken"
												aria-label="Passwort verstecken">
												PW
											</button>
											<button
												type="button"
												data-selection-action="quote"
												class="inline-flex h-8 items-center justify-center rounded-lg border border-white/10 px-2 text-xs text-slate-200 transition hover:bg-white/5"
												title="Blockquote">
												“
											</button>
											<button
												type="button"
												data-selection-action="ul"
												class="inline-flex h-8 items-center justify-center rounded-lg border border-white/10 px-2 text-xs text-slate-200 transition hover:bg-white/5"
												title="Bullet list">
												• List
											</button>
											<button
												type="button"
												data-selection-action="ol"
												class="inline-flex h-8 items-center justify-center rounded-lg border border-white/10 px-2 text-xs text-slate-200 transition hover:bg-white/5"
												title="Numbered list">
												1. List
											</button>
											<button
												type="button"
												data-selection-action="todo"
												class="inline-flex h-8 items-center justify-center rounded-lg border border-white/10 px-2 text-xs text-slate-200 transition hover:bg-white/5"
												title="Task list">
												☐ Task
											</button>
											<div class="mx-1 h-6 w-px bg-white/10"></div>
											<button
												type="button"
												data-selection-action="sort"
												class="inline-flex h-8 items-center justify-center rounded-lg border border-white/10 px-2 text-xs text-slate-200 transition hover:bg-white/5"
												title="Sort A–Z">
												Sort A–Z
											</button>
										</div>
									</div>
									<div
										id="codeLangWrap"
										class="absolute left-2 top-2 hidden flex items-center gap-2">
										<label for="codeLang" class="sr-only">Language</label>
										<select
											id="codeLang"
											class="h-9 w-36 rounded-lg border border-white/10 bg-slate-950/60 px-2.5 text-sm text-slate-100 shadow-soft backdrop-blur outline-none ring-1 ring-transparent transition focus:border-white/20 focus:ring-fuchsia-400/25"
											title="Language for code block">
											<option value="python">Python</option>
											<option value="javascript">JavaScript</option>
											<option value="bash">Shell</option>
											<option value="json">JSON</option>
											<option value="yaml">YAML</option>
											<option value="sql">SQL</option>
											<option value="html">HTML</option>
											<option value="css">CSS</option>
										</select>
									</div>
									<button
										id="tableMenuBtn"
										type="button"
										class="absolute right-2 top-12 hidden inline-flex h-9 w-9 items-center justify-center rounded-lg border border-white/10 bg-white/5 text-slate-200 transition hover:bg-white/10 active:bg-white/15"
										title="Table menu"
										aria-label="Table menu">
										<svg
											viewBox="0 0 24 24"
											fill="none"
											stroke="currentColor"
											stroke-width="2"
											stroke-linecap="round"
											stroke-linejoin="round"
											class="h-4 w-4">
											<rect x="3" y="3" width="18" height="18" rx="2" />
											<path d="M3 9h18" />
											<path d="M3 15h18" />
											<path d="M9 3v18" />
											<path d="M15 3v18" />
										</svg>
									</button>
									<button
										id="psMetaToggle"
										type="button"
										class="absolute left-2 top-2 inline-flex h-9 w-9 items-center justify-center rounded-lg border border-white/10 bg-white/5 text-slate-200 transition hover:bg-white/10 active:bg-white/15"
										title="Meta anzeigen/ausblenden"
										aria-label="Meta anzeigen/ausblenden"
										aria-pressed="true">
										<svg
											viewBox="0 0 24 24"
											fill="none"
											stroke="currentColor"
											stroke-width="2"
											stroke-linecap="round"
											stroke-linejoin="round"
											class="h-4 w-4">
											<circle cx="12" cy="12" r="9" />
											<path d="M12 10v6" />
											<path d="M12 7h.01" />
										</svg>
									</button>
									<button
										id="clearMirror"
										type="button"
										class="absolute right-2 top-2 inline-flex h-9 w-9 items-center justify-center rounded-lg border border-white/10 bg-white/5 text-slate-200 transition hover:bg-white/10 active:bg-white/15"
										title="Clear input"
										aria-label="Clear input">
										<svg
											viewBox="0 0 24 24"
											fill="none"
											stroke="currentColor"
											stroke-width="2"
											stroke-linecap="round"
											stroke-linejoin="round"
											class="h-4 w-4">
											<path d="M3 6h18" />
											<path d="M8 6V4h8v2" />
											<path d="M6 6l1 16h10l1-16" />
											<path d="M10 11v6" />
											<path d="M14 11v6" />
										</svg>
									</button>
									<button
										id="copyMirror"
										type="button"
										class="absolute bottom-2 right-2 inline-flex h-9 w-9 items-center justify-center rounded-lg border border-white/10 bg-white/5 text-slate-200 transition hover:bg-white/10 active:bg-white/15"
										title="Copy to clipboard"
										aria-label="Copy to clipboard">
										<svg
											viewBox="0 0 24 24"
											fill="none"
											stroke="currentColor"
											stroke-width="2"
											stroke-linecap="round"
											stroke-linejoin="round"
											class="h-4 w-4">
											<rect x="9" y="9" width="13" height="13" rx="2" />
											<path
												d="M5 15H4a2 2 0 0 1-2-2V4a2 2 0 0 1 2-2h9a2 2 0 0 1 2 2v1" />
										</svg>
									</button>
									<div
										id="psEditorTagsBar"
										class="absolute bottom-2 left-2 right-12 hidden">
										<label for="psEditorTagsInput" class="sr-only">Tags</label>
										<div
											class="flex h-9 items-center gap-2 rounded-lg border border-white/10 bg-slate-950 px-2.5 text-xs text-slate-200 shadow-soft backdrop-blur">
											<span class="text-slate-400">Tags:</span>
											<input
												id="psEditorTagsInput"
												type="text"
												autocomplete="off"
												spellcheck="false"
												placeholder="project, idea, lang-python"
												class="min-w-0 flex-1 bg-transparent text-slate-100 placeholder:text-slate-500 outline-none" />
										</div>
										<div
											id="psMetaYaml"
											class="pointer-events-none absolute left-2 right-12 top-2 hidden rounded-lg border border-white/5 bg-slate-950/40 px-2 py-1 text-[10px] leading-snug text-slate-400 backdrop-blur">
											<pre class="whitespace-pre-wrap font-mono"></pre>
										</div>
									</div>
								</div>
								<div
									class="mt-3 flex flex-wrap items-center justify-between gap-2">
									<div class="flex items-center gap-2">
										<button
											id="psNavBack"
											type="button"
											class="inline-flex h-9 w-9 items-center justify-center rounded-lg border border-white/10 bg-transparent text-slate-300 transition hover:bg-white/5 active:bg-white/10 disabled:pointer-events-none disabled:opacity-40"
											title="Back"
											aria-label="Back"
											disabled>
											<svg
												viewBox="0 0 24 24"
												fill="none"
												stroke="currentColor"
												stroke-width="2"
												stroke-linecap="round"
												stroke-linejoin="round"
												class="h-4 w-4">
												<path d="M15 18l-6-6 6-6" />
											</svg>
										</button>
										<button
											id="psNavForward"
											type="button"
											class="inline-flex h-9 w-9 items-center justify-center rounded-lg border border-white/10 bg-transparent text-slate-300 transition hover:bg-white/5 active:bg-white/10 disabled:pointer-events-none disabled:opacity-40"
											title="Forward"
											aria-label="Forward"
											disabled>
											<svg
												viewBox="0 0 24 24"
												fill="none"
												stroke="currentColor"
												stroke-width="2"
												stroke-linecap="round"
												stroke-linejoin="round"
												class="h-4 w-4">
												<path d="M9 6l6 6-6 6" />
											</svg>
										</button>
										<button
											id="togglePreview"
											type="button"
											class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-sm text-slate-200 transition hover:bg-white/5 active:bg-white/10">
											Preview
										</button>
										<button
											id="psSaveMain"
											type="button"
											class="rounded-xl border border-fuchsia-400/30 bg-fuchsia-500/15 px-3 py-2 text-sm font-semibold text-slate-100 shadow-soft transition hover:bg-fuchsia-500/20 active:opacity-90">
											Save
										</button>
										<span
											id="psAutoSaveStatus"
											class="hidden text-xs text-slate-400"></span>
									</div>
									<div class="flex items-center gap-3 text-xs text-slate-400">
										<span id="metaLeft">Ready.</span>
										<span id="metaRight"></span>
										<span id="psMainHint" class="hidden"></span>
									</div>
								</div>
							</div>
							<div
								id="previewPanel"
								class="hidden h-full min-h-56 sm:min-h-72 overflow-hidden rounded-xl border border-white/10 bg-slate-950/25">
								<div class="flex h-full min-h-0 flex-col">
									<div
										class="flex items-center justify-between gap-2 border-b border-white/10 bg-slate-950/30 px-3 py-2">
										<div class="text-xs font-medium text-slate-200">
											Preview
										</div>
									</div>
									<iframe
										id="mdPreview"
										title="Markdown Preview"
										class="min-h-0 flex-1"
										sandbox="allow-popups allow-scripts"
										referrerpolicy="no-referrer"></iframe>
									<div
										class="border-t border-white/10 bg-slate-950/20 px-3 py-3">
										<div
											class="flex items-center justify-between gap-2 text-[11px] text-slate-300">
											<div class="flex items-center gap-2">
												<span
													class="inline-flex h-5 w-5 items-center justify-center rounded-md bg-fuchsia-600/20 text-fuchsia-300">
													<svg
														viewBox="0 0 24 24"
														fill="none"
														stroke="currentColor"
														stroke-width="2"
														stroke-linecap="round"
														stroke-linejoin="round"
														class="h-3.5 w-3.5">
														<path
															d="M21 15a4 4 0 0 1-4 4H8l-5 3V7a4 4 0 0 1 4-4h10a4 4 0 0 1 4 4z" />
													</svg>
												</span>
												<span class="font-medium text-slate-200"
													>Ask Claude</span
												>
											</div>
										</div>
										<div class="mt-2 flex flex-col gap-2">
											<div class="flex flex-wrap items-center gap-2">
												<button
													id="aiUsePreviewBtn"
													type="button"
													class="inline-flex items-center gap-2 rounded-full border border-fuchsia-500/30 bg-fuchsia-600/60 px-3 py-1 text-[11px] font-medium text-slate-50 shadow-soft transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/40"
													title="Preview als Kontext verwenden"
													aria-pressed="true">
													<span
														class="inline-block h-2 w-2 rounded-full bg-white/80"></span>
													<span>Preview als Kontext verwenden</span>
												</button>
												<div id="aiModeWrap" class="min-w-[220px] flex-1">
													<select
														id="aiMode"
														class="h-9 w-full rounded-md border border-white/10 bg-slate-950/30 px-2.5 text-xs text-slate-200 shadow-soft backdrop-blur transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30"
														title="AI-Modus">
														<option value="" selected>Ohne Vorgabe</option>
														<option value="explain">
															Erklären / Antworten
														</option>
														<option value="fix">Fixen / Korrigieren</option>
														<option value="improve">Verbessern</option>
														<option value="run">Code ausführen</option>
														<option value="summarize">Zusammenfassen</option>
													</select>
												</div>
											</div>
											<div
												class="grid grid-cols-[minmax(0,1fr)_auto] items-center gap-2">
												<div
													id="aiPromptWrap"
													class="relative min-w-0 flex-1 group">
													<label for="aiPrompt" class="sr-only">Ask</label>
													<input
														class="h-9 w-full min-w-0 rounded-md border border-white/10 bg-slate-950/30 px-3 pr-9 text-sm text-slate-100 shadow-soft backdrop-blur transition placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30" />
													<button
														id="aiPromptClear"
														type="button"
														class="absolute right-1.5 top-1/2 -translate-y-1/2 h-7 w-7 rounded-md border border-white/10 bg-slate-950/10 text-sm text-slate-200 opacity-0 transition group-hover:opacity-100 focus:opacity-100 hover:bg-white/5 active:bg-white/10"
														title="Prompt leeren"
														aria-label="Prompt leeren">
														×
													</button>
												</div>
												<button
													id="aiAssist"
													type="button"
													class="h-9 w-9 shrink-0 rounded-md border border-fuchsia-500/30 bg-fuchsia-600/60 text-slate-50 shadow-soft transition hover:bg-fuchsia-600/70 active:bg-fuchsia-600/80 focus:outline-none focus:ring-2 focus:ring-fuchsia-400/40"
													title="Ask">
													<span class="sr-only">Ask</span>
													<svg
														viewBox="0 0 24 24"
														fill="none"
														stroke="currentColor"
														stroke-width="2"
														stroke-linecap="round"
														stroke-linejoin="round"
														class="mx-auto h-4 w-4">
														<path d="M5 12h12" />
														<path d="M13 6l6 6-6 6" />
													</svg>
												</button>
											</div>

											<div>
												<div
													class="flex items-center justify-between gap-2 text-[11px] text-slate-300">
													<div class="sr-only">
														<span id="runOutputIcon" aria-hidden="true"></span>
														<span id="runOutputTitle">AI</span>
													</div>
													<div class="flex flex-wrap items-center gap-2">
														<span id="runStatus" class="text-slate-400"></span>
														<button
															id="applyOutputReplace"
															type="button"
															class="hidden rounded-md border border-white/10 bg-transparent px-2 py-1 text-[11px] text-slate-200 transition hover:bg-white/5 active:bg-white/10"
															title="Replace editor with AI output">
															Replace
														</button>
														<button
															id="applyOutputAppend"
															type="button"
															class="hidden rounded-md border border-white/10 bg-white/10 px-2 py-1 text-[11px] text-slate-100 transition hover:bg-white/15 active:bg-white/20"
															title="Append AI output to editor">
															Append
														</button>
														<button
															id="clearRunOutput"
															type="button"
															class="hidden rounded-md border border-white/10 bg-transparent px-2 py-1 text-[11px] text-slate-200 transition hover:bg-white/5 active:bg-white/10"
															title="Clear output">
															Clear
														</button>
													</div>
												</div>
												<pre
													id="runOutput"
													class="mt-2 max-h-40 overflow-auto whitespace-pre-wrap break-words text-[12px] leading-relaxed text-slate-100"></pre>
											</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
				</section>
			</div>
		</main>

		<!-- App Modals (prompt/confirm replacement) -->
		<div
			id="tableModal"
			class="fixed inset-0 z-50 hidden items-center justify-center p-4"
			aria-hidden="true">
			<div
				data-role="tableModalBackdrop"
				class="absolute inset-0 bg-slate-950/70 backdrop-blur-sm"></div>
			<div
				role="dialog"
				aria-modal="true"
				aria-labelledby="tableModalTitle"
				class="relative w-full max-w-4xl overflow-hidden rounded-2xl border border-white/10 bg-slate-950/70 shadow-soft backdrop-blur">
				<div class="border-b border-white/10 px-5 py-4">
					<div class="flex items-center justify-between gap-3">
						<div>
							<h3
								id="tableModalTitle"
								class="text-base font-semibold text-slate-100">
								Table editor
							</h3>
							<p class="mt-1 text-xs text-slate-400">
								Edit cells, add/remove rows and columns, and insert
								calculations.
							</p>
						</div>
						<button
							id="tableModalClose"
							type="button"
							class="rounded-lg border border-white/10 bg-transparent px-2 py-1 text-xs text-slate-200 transition hover:bg-white/5 active:bg-white/10"
							aria-label="Close">
							Esc
						</button>
					</div>
					<div class="mt-3 flex flex-wrap items-center gap-2">
						<button
							id="tableAddRow"
							type="button"
							class="rounded-lg border border-white/10 bg-white/10 px-3 py-1.5 text-xs text-slate-100 transition hover:bg-white/15 active:bg-white/20">
							+ Row
						</button>
						<button
							id="tableDelRow"
							type="button"
							class="rounded-lg border border-white/10 bg-transparent px-3 py-1.5 text-xs text-slate-200 transition hover:bg-white/5 active:bg-white/10">
							- Row
						</button>
						<button
							id="tableAddCol"
							type="button"
							class="rounded-lg border border-white/10 bg-white/10 px-3 py-1.5 text-xs text-slate-100 transition hover:bg-white/15 active:bg-white/20">
							+ Column
						</button>
						<button
							id="tableDelCol"
							type="button"
							class="rounded-lg border border-white/10 bg-transparent px-3 py-1.5 text-xs text-slate-200 transition hover:bg-white/5 active:bg-white/10">
							- Column
						</button>
						<span class="ml-auto text-xs text-slate-500" id="tableActiveCell">
							Cell: —
						</span>
					</div>
				</div>
				<div class="grid gap-4 p-5 lg:grid-cols-[1fr_260px]">
					<div
						id="tableGridWrap"
						class="max-h-[60vh] overflow-auto rounded-xl border border-white/10 bg-slate-950/40 p-3 shadow-inner"></div>
					<div class="rounded-xl border border-white/10 bg-slate-950/40 p-4">
						<div class="text-xs font-semibold text-slate-200">Calculations</div>
						<div class="mt-3 flex flex-col gap-2 text-xs text-slate-300">
							<label class="flex items-center gap-2">
								<span class="w-16 text-slate-400">Scope</span>
								<select
									id="tableCalcScope"
									class="h-8 flex-1 rounded-lg border border-white/10 bg-slate-950/60 px-2 text-xs text-slate-100">
									<option value="col">Column</option>
									<option value="row">Row</option>
								</select>
							</label>
							<label class="flex items-center gap-2">
								<span class="w-16 text-slate-400">Index</span>
								<input
									id="tableCalcIndex"
									type="number"
									min="1"
									value="1"
									class="h-8 w-full rounded-lg border border-white/10 bg-slate-950/60 px-2 text-xs text-slate-100" />
							</label>
							<div class="mt-2 grid gap-2 text-xs">
								<div class="flex items-center justify-between">
									<span class="text-slate-400">Sum</span>
									<span id="tableCalcSum" class="text-slate-100">—</span>
								</div>
								<div class="flex items-center justify-between">
									<span class="text-slate-400">Avg</span>
									<span id="tableCalcAvg" class="text-slate-100">—</span>
								</div>
								<div class="flex items-center justify-between">
									<span class="text-slate-400">Max</span>
									<span id="tableCalcMax" class="text-slate-100">—</span>
								</div>
								<div class="flex items-center justify-between">
									<span class="text-slate-400">Min</span>
									<span id="tableCalcMin" class="text-slate-100">—</span>
								</div>
							</div>
							<div class="mt-3 grid grid-cols-2 gap-2">
								<button
									id="tableInsertSum"
									type="button"
									class="rounded-lg border border-white/10 bg-white/10 px-2 py-1.5 text-xs text-slate-100 transition hover:bg-white/15 active:bg-white/20">
									Insert Sum
								</button>
								<button
									id="tableInsertAvg"
									type="button"
									class="rounded-lg border border-white/10 bg-white/10 px-2 py-1.5 text-xs text-slate-100 transition hover:bg-white/15 active:bg-white/20">
									Insert Avg
								</button>
								<button
									id="tableInsertMax"
									type="button"
									class="rounded-lg border border-white/10 bg-white/10 px-2 py-1.5 text-xs text-slate-100 transition hover:bg-white/15 active:bg-white/20">
									Insert Max
								</button>
								<button
									id="tableInsertMin"
									type="button"
									class="rounded-lg border border-white/10 bg-white/10 px-2 py-1.5 text-xs text-slate-100 transition hover:bg-white/15 active:bg-white/20">
									Insert Min
								</button>
							</div>
							<p class="mt-3 text-[11px] text-slate-500">
								Only numeric cells are used. Click a cell to set the target for
								insert.
							</p>
						</div>
					</div>
				</div>
				<div
					class="flex items-center justify-end gap-2 border-t border-white/10 bg-slate-950/30 px-5 py-3">
					<button
						id="tableModalCancel"
						type="button"
						class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-sm text-slate-200 transition hover:bg-white/5 active:bg-white/10">
						Cancel
					</button>
					<button
						id="tableModalApply"
						type="button"
						class="rounded-lg border border-white/10 bg-white/10 px-3 py-2 text-sm font-medium text-slate-100 transition hover:bg-white/15 active:bg-white/20">
						Apply
					</button>
				</div>
			</div>
		</div>

		<div
			id="settingsRoot"
			class="fixed inset-0 z-50 hidden items-center justify-center p-4"
			aria-hidden="true">
			<div
				id="settingsBackdrop"
				class="absolute inset-0 bg-slate-950/70 backdrop-blur-sm"></div>
			<div
				id="settingsPanel"
				role="dialog"
				aria-modal="true"
				aria-labelledby="settingsTitle"
				class="relative flex h-full max-h-[86vh] w-full max-w-4xl flex-col overflow-hidden rounded-2xl border border-white/10 bg-slate-950/80 shadow-soft backdrop-blur">
				<header
					class="flex items-center justify-between border-b border-white/10 px-5 py-4">
					<div>
						<h3
							id="settingsTitle"
							class="text-base font-semibold text-slate-100">
							Settings
						</h3>
						<p class="mt-1 text-xs text-slate-400">
							Manage account, export/import, themes, AI, and help.
						</p>
					</div>
					<button
						id="settingsClose"
						type="button"
						class="rounded-lg border border-white/10 bg-transparent px-2.5 py-1.5 text-xs text-slate-200 transition hover:bg-white/5 active:bg-white/10"
						aria-label="Close settings">
						Esc
					</button>
				</header>
				<div class="flex min-h-0 flex-1 flex-col sm:flex-row">
					<nav
						id="settingsNav"
						class="flex shrink-0 flex-row gap-2 overflow-x-auto border-b border-white/10 px-4 py-3 sm:w-56 sm:flex-col sm:border-b-0 sm:border-r sm:px-3 sm:py-4">
						<button
							type="button"
							data-settings-nav="user"
							class="rounded-lg border border-white/10 bg-white/10 px-3 py-2 text-left text-xs text-slate-100 transition hover:bg-white/15">
							User Settings
						</button>
						<button
							type="button"
							data-settings-nav="export"
							class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-left text-xs text-slate-200 transition hover:bg-white/5">
							Export/Import
						</button>
						<button
							type="button"
							data-settings-nav="themes"
							class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-left text-xs text-slate-200 transition hover:bg-white/5">
							Themes
						</button>
						<button
							type="button"
							data-settings-nav="ai"
							class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-left text-xs text-slate-200 transition hover:bg-white/5">
							AI
						</button>
						<button
							type="button"
							data-settings-nav="faq"
							class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-left text-xs text-slate-200 transition hover:bg-white/5">
							FAQ
						</button>
					</nav>
					<div class="min-h-0 flex-1 overflow-y-auto px-5 py-4">
						<section data-settings-section="user" class="space-y-3">
							<div>
								<h4 class="text-sm font-semibold text-slate-100">
									User Settings
								</h4>
								<p class="mt-1 text-xs text-slate-400">
									Personal Space identity and sign-out.
								</p>
							</div>
							<div
								id="psUserAuthed"
								class="hidden rounded-xl border border-white/10 bg-white/5 p-3">
								<div class="text-xs text-slate-300">
									Signed in as
									<span id="psEmail" class="font-medium text-slate-100"></span>
								</div>
								<button
									id="psLogout"
									type="button"
									class="mt-3 rounded-lg border border-white/10 bg-transparent px-3 py-2 text-xs text-slate-200 transition hover:bg-white/5 active:bg-white/10">
									Sign out
								</button>
							</div>
							<div
								id="psUserUnauthed"
								class="rounded-xl border border-white/10 bg-slate-950/40 p-3 text-xs text-slate-400">
								Not signed in. Use "Add Personal Space" to get started.
							</div>
						</section>

						<section data-settings-section="export" class="hidden space-y-3">
							<div>
								<h4 class="text-sm font-semibold text-slate-100">
									Export/Import
								</h4>
								<p class="mt-1 text-xs text-slate-400">
									Back up or import your Personal Space notes.
								</p>
							</div>
							<div class="flex flex-wrap items-center gap-2">
								<button
									id="psExportNotes"
									type="button"
									class="rounded-lg border border-white/10 bg-white/5 px-3 py-2 text-xs text-slate-200 transition hover:bg-white/10 active:bg-white/15">
									Export
								</button>
								<select
									id="psImportMode"
									class="rounded-lg border border-white/10 bg-slate-950/30 px-2.5 py-2 text-xs text-slate-200 shadow-soft backdrop-blur transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30">
									<option value="merge" selected>Merge</option>
									<option value="replace">Replace</option>
								</select>
								<button
									id="psImportNotes"
									type="button"
									class="rounded-lg border border-white/10 bg-white/5 px-3 py-2 text-xs text-slate-200 transition hover:bg-white/10 active:bg-white/15">
									Import
								</button>
								<input
									id="psImportFile"
									type="file"
									accept="application/json,text/markdown,text/plain,.json,.md,.markdown,.txt"
									class="hidden" />
							</div>
							<div id="psTransferHint" class="text-xs text-slate-400"></div>
						</section>

						<section data-settings-section="themes" class="hidden space-y-3">
							<div>
								<h4 class="text-sm font-semibold text-slate-100">Themes</h4>
								<p class="mt-1 text-xs text-slate-400">
									Choose a background style. Stored locally.
								</p>
							</div>
							<div class="max-w-sm">
								<label for="settingsTheme" class="sr-only">Theme</label>
								<select
									id="settingsTheme"
									class="w-full rounded-lg border border-white/10 bg-slate-950/30 px-3 py-2 text-sm text-slate-200 shadow-soft backdrop-blur transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30">
									<option value="fuchsia" selected>Fuchsia</option>
									<option value="cyan">Cyan</option>
									<option value="emerald">Emerald</option>
									<option value="amber">Amber</option>
									<option value="violet">Violet</option>
								</select>
							</div>
						</section>

						<section data-settings-section="ai" class="hidden space-y-3">
							<div>
								<h4 class="text-sm font-semibold text-slate-100">AI</h4>
								<p class="mt-1 text-xs text-slate-400">
									API key is stored locally and used per request.
								</p>
							</div>
							<div class="grid gap-3 sm:grid-cols-2">
								<div class="sm:col-span-2">
									<label for="aiApiKey" class="text-xs text-slate-300">
										Anthropic API-Key
									</label>
									<input
										id="aiApiKey"
										type="password"
										placeholder="sk-ant-..."
										class="mt-1 w-full rounded-lg border border-white/10 bg-slate-950/30 px-3 py-2 text-sm text-slate-100 shadow-soft backdrop-blur transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30" />
								</div>
								<div>
									<label for="aiApiModel" class="text-xs text-slate-300">
										Model (optional)
									</label>
									<input
										id="aiApiModel"
										type="text"
										placeholder="claude-3-5-sonnet-20241022"
										class="mt-1 w-full rounded-lg border border-white/10 bg-slate-950/30 px-3 py-2 text-sm text-slate-100 shadow-soft backdrop-blur transition focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30" />
								</div>
								<div class="flex items-end gap-2">
									<button
										id="aiApiSave"
										type="button"
										class="rounded-lg border border-white/10 bg-white/10 px-3 py-2 text-xs text-slate-100 transition hover:bg-white/15 active:bg-white/20">
										Save
									</button>
									<button
										id="aiApiClear"
										type="button"
										class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-xs text-slate-200 transition hover:bg-white/5 active:bg-white/10">
										Clear
									</button>
								</div>
							</div>
							<div id="aiApiStatus" class="text-xs text-slate-400"></div>
						</section>

						<section data-settings-section="faq" class="hidden space-y-3">
							<div>
								<h4 class="text-sm font-semibold text-slate-100">FAQ</h4>
								<p class="mt-1 text-xs text-slate-400">
									Quick answers and tips.
								</p>
							</div>
							<div class="max-w-md">
								<label for="faqSearch" class="sr-only">Search FAQ</label>
								<input
									id="faqSearch"
									type="search"
									placeholder="Search…"
									class="w-full rounded-lg border border-white/10 bg-slate-950/30 px-3 py-2 text-sm text-slate-200 shadow-soft backdrop-blur transition placeholder:text-slate-500 focus:outline-none focus:ring-2 focus:ring-fuchsia-400/30" />
							</div>
							<div id="faqList" class="space-y-3"></div>
						</section>
					</div>
				</div>
			</div>
		</div>

		<div
			id="modalRoot"
			class="fixed inset-0 z-50 hidden items-center justify-center p-4"
			aria-hidden="true">
			<div
				data-role="modalBackdrop"
				class="absolute inset-0 bg-slate-950/70 backdrop-blur-sm"></div>
			<div
				role="dialog"
				aria-modal="true"
				aria-labelledby="modalTitle"
				aria-describedby="modalDesc"
				class="relative w-full max-w-md overflow-hidden rounded-2xl border border-white/10 bg-slate-950/70 shadow-soft backdrop-blur">
				<div class="p-5">
					<div class="flex items-start justify-between gap-3">
						<h3 id="modalTitle" class="text-base font-semibold text-slate-100">
							Modal
						</h3>
						<button
							id="modalClose"
							type="button"
							class="rounded-lg border border-white/10 bg-transparent px-2 py-1 text-xs text-slate-200 transition hover:bg-white/5 active:bg-white/10"
							aria-label="Close">
							Esc
						</button>
					</div>
					<p id="modalDesc" class="mt-2 text-sm text-slate-300"></p>
					<div id="modalInputWrap" class="mt-3 hidden">
						<label for="modalInput" class="sr-only">Input</label>
						<input
							id="modalInput"
							type="text"
							autocomplete="off"
							class="w-full rounded-xl border border-white/10 bg-slate-950/40 px-3 py-2 text-sm text-slate-100 shadow-inner outline-none ring-1 ring-transparent transition placeholder:text-slate-500 focus:border-white/20 focus:ring-fuchsia-400/25" />
					</div>
				</div>
				<div
					class="flex items-center justify-end gap-2 border-t border-white/10 bg-slate-950/30 px-5 py-3">
					<button
						id="modalCancel"
						type="button"
						class="rounded-lg border border-white/10 bg-transparent px-3 py-2 text-sm text-slate-200 transition hover:bg-white/5 active:bg-white/10">
						Cancel
					</button>
					<button
						id="modalOk"
						type="button"
						class="rounded-lg border border-white/10 bg-white/10 px-3 py-2 text-sm font-medium text-slate-100 transition hover:bg-white/15 active:bg-white/20">
						OK
					</button>
				</div>
			</div>
		</div>

		<!-- Markdown Preview libs (client-side, no build step) -->
		<script src="https://cdn.jsdelivr.net/npm/markdown-it@14.1.0/dist/markdown-it.min.js"></script>
		<script src="https://cdn.jsdelivr.net/npm/markdown-it-task-lists@2.1.1/dist/markdown-it-task-lists.min.js"></script>
		<script src="https://cdn.jsdelivr.net/gh/highlightjs/cdn-release@11.9.0/build/highlight.min.js"></script>
		<script src="/app.js?v=2026-01-15-17"></script>
	</body>
</html>
